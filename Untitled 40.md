该研究探讨了大脑的**结构连接（connectome）与功能连接（functional connectivity）之间的映射关系**，并介绍了一种称为“**Connectome embedding**”（CE）的方法，该方法能够更好地捕捉大脑图谱中节点的高阶关系。通常情况下，大脑结构连接被表示为一个矩阵，其中包含所有大脑区域之间的连接信息。然而，**这种表示方式无法捕捉到大脑图谱中节点之间的更高阶关系**。

Connectome embedding通过**将节点表示为在全局网络拓扑中的紧凑向量**表示来解决这一限制。在这个方法中，**节点的“context”是由其在大脑图谱上的随机游走定义的，因此它代表了节点周围的扩散式通讯的生成模型**。之前的研究已经证明，对于**群体平均的结构连接，CE能够捕捉大脑半球间同源区域之间的关系，并揭示网络重构中可能缺失的边缘。**

在本研究中，研究人员将CE方法扩展到了个体差异的探索，并提出了一种新颖的嵌入对齐方法。他们**在两个包含了扩散加权成像、静息态功能磁共振、人口统计学和行为测量数据的生命周期数据集（NKI：n=542；Cam-CAN：n=601）中测试了这种方法**。结果显示，用CE对功能连接进行建模**可以显著提高结构到功能连接的映射效果**，无论是在群体水平还是个体水平上。此外，**年龄相关差异在这个结构-功能映射中得到保留和增强**。重要的是，**CE通过对年龄和智力进行样本外预测捕捉了个体差异**。**预测准确性与使用结构连接和功能连接相比更高。研究人员认为，这些发现是因为CE能够综合解剖学（结构图）和功能（扩散通讯）的方面**。







这种新颖的方法使得我们可以通过**结构、功能和行为来揭示大脑连接图谱中的个体差异**。理解行为的神经基础是神经科学的一个基本目标。过去，人们通常通过将个体大脑区域的结构和活动模式与行为表型或认知任务相关联来探索这一目标。然而，大多数复杂的行为是通过多个区域的集成贡献来实现的，这些区域形成了一个连贯的、分布式的网络。Connectome作为大脑结构连接的综合地图，可以通过网络科学的方法和工具来描述和研究。最近的研究已经深入研究了网络中的个体节点或模块的组织，以支持专门的功能认知系统。

Connectome通常被表示为一个矩阵，**其中包含了所有大脑区域之间的连接信息**。然而，这种表示方式有限，因为它**无法捕捉到网络中高阶的关系**。Connectome embedding是一种**用于找到节点紧凑向量表示的替代方法**，该向量表示能够捕捉节点的**局部和全局拓扑属性**。这种方法借鉴了自然语言处理领域的Word2Vec算法，该算法**将单词嵌入到一个低维空间中，保持了它们在给定文本语料库中的上下文。这些向量表示通过简单的向量算术来捕捉单词之间的语义关系**。例如，**vec（“King”）-vec（“Man”）+ vec（“Woman”）的结果在余弦相似性方面更接近vec（“Queen”）而不是其他任何单词**。受到将这种方法应用于图嵌入的启发（Grover and Leskovec，2016；Perozzi et al.，2014），**Connectome embedding通过捕捉由脑图上的随机游走定义的节点“上下文”来创建节点的向量表示。结果显示，这些向量能够捕捉半球间同源脑区之间的关系，并揭示了结构网络重构中可能缺失的边缘**。

在本研究中，研究人员将Connectome embedding方法扩展到探索个体差异，并提出了一种新颖的嵌入对齐方法。他们在两个生命周期数据集（NKI：n=542；Cam-CAN：n=601）中测试了这种方法，这些数据集包含扩散加权成像、静息态功能磁共振、**人口统计学和行为测量数据。结果显示，使用Connectome embedding对功能连接进行建模可以显著提高结构到功能连接的映射效果**，无论是在群体水平还是个体水平上。此外，**年龄相关差异在这种结构-功能映射中得到保留和增强**。重要的是，**Connectome embedding能够通过对年龄和智力进行样本外预测来捕捉个体差异，预测准确性比使用结构连接和功能连接更高**。这些发现被归因于Connectome embedding能够综合解剖学（结构图）和功能（扩散通讯）的方面。



长期以来，神经科学一直认为结构决定功能（Kristan和Katz，2006）。因此，**结构性脑连接与功能性脑连接之间的对应关系**是连接组研究的核心问题之一（Honey等，2010；Suárez等，2020）。这两者是大脑连接的不同但互补的测量指标。**结构性连接量化了神经元元素之间的物理连接，而功能性连接则测量它们时间序列之间的统计依赖性**。虽然功能性连接依赖于结构性框架，**但两者之间的相关性仅中等程度（Honey等，2009；Suárez等，2020）。部分原因在于驱动功能性连接的更高阶交互在二元结构连接中缺失**（Adachi等，2012）。**这样的高阶关系在连接组嵌入（CE）中得到捕捉，事实上，之前的研究显示它们解释了功能性连接中观察到的更大部分的方差**（Rosenthal等，2018）。这些之前的尝试是在群体水平进行的，但检验这种映射是否也可应用于个体水平，并且是否保留了个体间的结构-功能关系的差异性是至关重要的。

大规模的数据共享计划使得预测建模技术在研究个体差异并在大型队列中进行验证成为可能。然而，由于连接性数据的高复杂性和高维度性，将这些技术应用于连接性数据仍然具有挑战性。**CE提供了一个有前途的补充框架，通过在低维空间中表示节点，同时保留它们在全局网络拓扑中的上下文。然而，利用这些节点表示进行功能和行为预测需要将它们相互对齐到相同的潜在空间**，**以便在个体之间进行比较**。**在同一脑图上进行的Word2Vec算法的多次拟合迭代得到一组向量，在相互之间具有相似的相对位置，但其绝对值却不同**（Dev等，2019；关于嵌入之间关系的稳定性，请参阅Wang等，2020）。在机器翻译领域，**通常通过找到最小化从一种语言到另一种语言的单词距离的变换来解决这个问题**（Smith等，2017）。然而，**这样的方法不易于用于个体之间的大脑节点对齐，因为它还会消除与底层结构连接差异相关的差异性。因此，应用CE框架来探索个体差异需要一种保留这种结构性差异的对齐方法**。

在当前工作中，我们通过提出一种新的方法，**将分别学习的嵌入对齐到一个共同的潜在空间（图1），进一步推进了CE框架**。这种对齐基于一个**闭合形式的解决方案，利用嵌入拟合过程中确定的参数**。我们利用两个大规模的生命周期队列（Nooner等，2012；Taylor等，2015）验证了这种方法，这些队列包括了弥散加权成像、静息态fMRI以及人口学和认知性能测量。我们**在个体和个体之间对齐CE，并测试对齐对节点的相似性和嵌入之间的关系的影响**。然后，我们**证明CE能够在个体水平上改善结构到功能连接的映射，这与之前在群体水平上的研究结果一致**（Rosenthal等，2018）。我们**进一步研究了这种映射是否在网络水平和边缘水平上保留了与年龄相关的变化**。将**CE解释为围绕节点进行扩散通信的生成模型，我们测试了随机游走参数对结构-功能映射的影响。最后，我们检验了对齐的嵌入是否可以用于预测保留样本中的年龄和智力**。我们详细推导了CE拟合和对齐过程，并分享了一组交互式笔记本以复现主要发现，并提供了Python软件包实现（Cepy; https://github.com/gidlev/cepy）。



2.1. 参与者 

数据来自**两个生命周期大规模横断面研究**，包括功能、结构和弥散磁共振成像（MRI），以及人口学和行为数据。

第一个数据集是增强的Nathan Kline Institute-Rockland Sample（eNKI-RS；Nooner等，2012），第二个是剑桥老龄和神经科学中心的数据集（Cam-CAN；Shafto等，2014；Taylor等，2015），分别简称为数据集1（DS1）和数据集2（DS2）。

**DS1由542名受试者（305名女性，192名男性）**，年龄为**7-84岁**，从美国纽约州的Rockland县招募而来。所有参与者提供了知情同意，并且该研究获得了Nathan Kline Institute（#226781和#239708）和蒙特克莱尔州立大学（#000983A和#000983B）的机构审查委员会的批准。数据可以在http://fcon_1000.projects.nitrc.org/indi/enhanced/neurodata.html上公开获得。

**DS2包括601名受试者，年龄在18-87岁之间，**来自英国剑桥市，受试者分布均匀。所有参与者提供了知情同意，并且该研究获得了剑桥郡2号研究伦理委员会的批准（参考：10/H0308/50）。数据可以在https://camcan-archive.mrc-cbu.cam.ac.uk/dataaccess/上通过在线访问请求免费获得。关于两个样本的招募、资格标准和人口学信息的更多信息可在相关出版物中获得（Nooner等，2012；Shafto等，2014）。排除标准包括成功完成预处理和质量控制阶段，并在方法（2.3）和补充信息（SI 2）中详细说明。

2.2. MRI采集 DS1和DS2均在3T西门子扫描仪上获得。

对于每个数据集的每个受试者，都进行了T1加权图像（T1w）、弥散加权图像（DWI）和静息态功能性磁共振成像（rsfMRI）的采集。两个数据集都包括标准的T1w解剖学采集。

DS1包括128个方向的DWI，b值为1500 s/mm²，DS2包括60个方向的DWI，分别在两个b值为1000和2000 s/mm²的壳内。

DS1包括相对较短的0.645秒重复时间的rsfMRI采集，扫描时间为9.68分钟，DS2包括更标准的重复时间约为2秒的rsfMRI采集，扫描时间为8.56分钟。每个数据集中每个采集的具体参数可以在SI表格1中找到。

2.3. MRI预处理 这里我们报告了DS1和DS2分别应用的独立预处理流程的概述。鉴于最近有关MRI分析处理策略影响的报道（Botvinik-Nezer等，2020），我们打算在采用不同处理流程的两个数据集中展示收敛结果。两个数据集的完整预处理细节都包含在SI第1节中。

DS1和DS2的T1w扫描均通过FreeSurfer（版本6.0）的recon-all处理流程进行预处理。使用FreeSurfer的皮层分割和球面变形将分区转换到每个受试者的体积解剖空间。**对于DS1，采用了Schaefer 200节点的皮质分区（Schaefer等，2018），而对于DS2，则采用了Connectome Mapping toolkit渲染的Lausanne 233节点分区**（219个皮质，14个亚皮质；Gerhard等，2011）。

DS1和DS2的DWI经历了以下预处理步骤：去噪、运动和涡流校正，以及通过FreeSurfer的白质分割进行T1w对齐（Ades-Aron等，2018；Bathelt等，2017）。对于两个数据集，通过Dipy包（Garyfallidis等，2014）进行局部定向建模和纤维追踪。DS1使用概率性纤维束追踪，在每个白质体素中播种了五次。DS2使用确定性纤维束追踪，种子密度为27。在两个数据集中，长度小于10毫米的纤维束或不在灰质中终止的纤维束被丢弃。

DS1的功能图像通过fMRIPrep（版本1.1.8；Esteban等，2019）进行预处理，DS2的图像则通过可配置连接分析流程（C-PAC；Cameron等，2013）进行预处理。简要地说，这两个流程都包括以下步骤：切片定时校正、运动校正、头骨剥离和运动参数估计以及其他干扰信号时间序列。对于DS1，预处理后的图像在受试者的T1w空间中以rsfMRI的原始分辨率呈现。对于DS2，预处理后的图像在rsfMRI空间中呈现。

对于DS1和DS2，结构连接矩阵通过计算在区域之间的纤维束数并以这些区域的体积进行归一化来构建，从而得到纤维束密度。对于DS1和DS2，对于结构连接矩阵中有超过10个节点的度为0的受试者，将其排除在外，不在后续分析中使用（DS1：无被排除，保留542个；DS2：6%被排除，保留601个）。**两个数据集的样本被划分为训练集（67%）和测试集（33%）**，以进行后续需要外样本精度估计的分析**（DS1：361和181，DS2：401和200；分别为训练和测试受试者**）。

在DS1和DS2中，功能连接矩阵是在过滤功能体积的干扰信号后渲染的。对于DS1的rsfMRI，首先丢弃了前四帧。然后对数据进行带通滤波（0.008-0.08Hz）和共线性回归，以6个运动估计、在CSF、WM和整个脑掩膜中得出的平均时间序列，这九个回归器的导数以及这18个项的平方为基础进行回归。对于每个帧，超过0.5mm的运动幅度被添加为spike回归器。数据进行了线性去趋势化和标准化。排除标准包括超过15%的spike帧和异常的图像质量指标（4%被排除；剩下542名受试者；更多细节见SI 6.2）。对于DS2的rsfMRI，首先回归了白质和CSF信号的前5个主成分（Behzadi等，2007），然后回归了6个运动参数和线性、二次趋势，全局信号回归，最后进行了0.1至0.01 Hz的时态滤波。最后，应用了0.5 mm帧间位移的洗涤阈值（Power等，2014；在过度运动前1个TR和过度运动后2个TR进行清除）。过度运动的排除标准是事先确定的，即洗涤过程后静息态会话的时间少于50%（4分钟20秒）（25%被排除；剩下452名受试者）。

2.4. 智力评估 

**结构连接先前与智力的行为测量相关联**（Booth等，2013；Penke等，2012），并且在这里被用来**测试CE方法捕获个体间行为差异的能力**。在DS1中，使用Wechsler简略智力量表的全尺度（WASI-II；Wechsler，1999）评估普通智力。**DS2中的受试者接受Cattell文化公平测试，Scale 2 Form A，旨在独立于文化差异测量流体智力**（CFIT；Cattell和Cattell，1973）。在相关分析中，我们使用训练和测试集中的受试者样本，这些样本**具有结构连接矩阵和智力行为分数**（DS1：528；DS2：587）。然后，为了排除异常值，智力分数大于均值2个标准差的参与者从分析中被排除（DS1：0%被排除，保留528个；DS2：4%被排除，保留565个）。

**DS1中的WASI-II全尺度得分产生了根据样本内年龄调整的得分，与年龄在样本内无相关性（r(526) = 0.038，p = 0.386）**。

**DS2中，CFIT作为所有测试项目的原始准确性分数出现。这个分数与年龄显著相关（r(563) = -0.652，p < 2.2e-16），因此它是与年龄相关的智力度量**。

2.5. 节点嵌入-总体概述和随机游走抽样 

与以前的工作一样（Rosenthal等，2018），我们使用word2vec算法（Mikolov等，2013）**基于节点的高级拓扑关系创建大脑节点的向量化表示。最初，word2vec算法是用于创建单词嵌入，以保留它们在句子中的上下文。具体来说，模型给定一个单词w及其上下文c的语料库。它的目标是通过最大化skip-gram模型的条件概率p(c|w;𝜃)或连续词袋（CBOW）模型的条件概率p(w|c;𝜃)**（Goldberg和Levy，2014）**来学习一组参数𝜃**。简而言之，模型的目标是在**给定目标词或目标词的上下文的情况下预测上下文**。前者在本文中使用。最近，word2vec已被应用于嵌入图节点而不是文本（node2vec：Grover和Leskovec，2016；Deepwalk：Perozzi等，2014）。在这里，为了嵌入脑图，我们使用了**来自参数化脑结构图上的随机游走序列（s = 3）的滑动固定大小的窗口s**。在每个训练样本中，**序列中的中心节点是目标w，周围的节点是上下文c。周围的节点被定义为在行走序列内的目标节点w之前和之后出现的s个节点**。在窗口内上下文节点的顺序未保留。**训练样本是通过从每个节点(o = 800, l = 20)初始化长为l的参数化随机游走序列而产生的**。我们在第2.11节中进一步阐述了参数化随机游走过程。所有模型参数都设置为与Rosenthal等人（2018）使用的参数相同。

2.6. 节点嵌入-模型实现和参数估计

**来自参数化脑结构图上的随机游走序列（s = 3）的滑动固定大小的窗口s**。在每个训练样本中，**序列中的中心节点是目标w，周围的节点是上下文c。周围的节点被定义为在行走序列内的目标节点w之前和之后出现的s个节点**。在窗口内上下文节点的顺序未保留。**训练样本是通过从每个节点(o = 800, l = 20)初始化长为l的参数化随机游走序列而产生的**。

 在最简单的形式下，该模型表示为一个**具有一个隐藏层的全连接人工神经网络（ANN）**，**即嵌入层，没有激活函数**。**上下文{c1，...，c2×s}和目标w节点都使用“one-hot编码”来表示，这意味着节点i被编码为一个向量，其中除了第i个位置为1外，所有其他位置都为零。输入层和输出层中的神经元数为图中节点的数目k**，**嵌入层中的神经元数设置为k’**，通常情况下，k’< k（**这里k’ = 30**）。输入层、嵌入层和输出层之间的转换，这里表示为vinput、vembed、voutput，使用两个权重矩阵定义。**一个k × k’矩阵W在输入层和嵌入层之间，一个k’ × k矩阵W’在嵌入层和输出层之间：**

<img src="/Users/haozhipeng/Library/Application Support/typora-user-images/截屏2023-07-24 下午3.28.23.png" alt="截屏2023-07-24 下午3.28.23" style="zoom:50%;" />

这一部分描述了**节点嵌入的计算和CE（Common Embedding）的对齐过程**。

首先，**嵌入层是通过上下文节点向量与W矩阵的向量矩阵乘积的平均值计算得出的**（见方程1）。

矩阵W和W'都是通过对给定随机游走样本拟合模型来学习得到的。实际上，该模型执行的是一个分类任务，其中输入是上下文节点{c1,…,c2×s}，目标是预测目标节点w

然后，通过**对输出层应用Softmax函数来将其归一化为和为1的概率分布**。具体地，对于第i个条目：

<img src="/Users/haozhipeng/Library/Application Support/typora-user-images/截屏2023-07-24 下午3.36.13.png" alt="截屏2023-07-24 下午3.36.13" style="zoom:50%;" /> 

**接下来，通过取目标节点w条目的负对数（对数损失）来计算模型的损失**（方程4）。

<img src="/Users/haozhipeng/Library/Application Support/typora-user-images/截屏2023-07-24 下午3.53.57.png" alt="截屏2023-07-24 下午3.53.57" style="zoom:50%;" />

在给定一个训练样本的情况下，**通过对每个矩阵的损失进行偏导数计算模型的参数𝜃，即权重矩阵W和W'的更新。**参数在每次观察到单个样本或一批训练样本后进行迭代更新，即采用随机梯度下降的方法。关于该模型和训练过程的更深入的细节，包括超出当前工作范围的实现细节（如负采样），可以参考Rong（2014)的研究。

随后，对节点嵌入进行了CE对齐。**不同的嵌入算法可能会导致节点之间的余弦角度相似，但不一定具有相似的绝对值**（Dev等，2019）。为了解决这个问题，提出了一种新的方法，使得可以**将独立学习得到的嵌入对齐到相同的潜在空间**。对于每个训练好的模型，有两个不同的表示：**第一个表示在输入和输出层中，由one-hot编码定义，其中每个条目对应于特定的节点**；**第二个表示是嵌入层的表示，对于每个训练好的模型是唯一的。通过已学习的矩阵W和W'，这两个表示之间进行转换**。**第一个变换W将输入维度从k降低到k'，并且有效地包含了每个节点的嵌入。第二个变换W'将嵌入层的维度k'增加到输出层的维度k**。**虽然通常在对数据进行拟合后只保留第一个矩阵W，但是建议使用第二个矩阵W'作为从一个潜在空间到另一个潜在空间的变换**。因此，**通过两个独立训练的模型a和b的不同潜在嵌入空间，我们可以将节点i的潜在表示从空间a转换到空间b**。

First, the embedding of node *i* in space *a* could be derived by taking the

*i* *th* row of *W*a, or equivalently multiply the one-hot encoding of node *i,*

*v**inputi*, with *W*a:

<img src="/Users/haozhipeng/Library/Application Support/typora-user-images/截屏2023-07-24 下午4.03.02.png" alt="截屏2023-07-24 下午4.03.02" style="zoom: 150%;" />首先，在空间a中，可以通过提取**Wa的第i行来获得节点i的嵌入**，或者等价地，**将节点i的one-hot编码 vinputi 与Wa相乘来获得嵌入**。**得到节点i在空间a中的嵌入表示**。<img src="/Users/haozhipeng/Library/Application Support/typora-user-images/截屏2023-07-24 下午4.10.43.png" alt="截屏2023-07-24 下午4.10.43"  />

然后，**将该向量与W'a相乘，将其转换为ANN的输出表示**：<img src="/Users/haozhipeng/Library/Application Support/typora-user-images/截屏2023-07-24 下午4.11.10.png" alt="截屏2023-07-24 下午4.11.10"  />

我们假设由于one-hot表示约束在所有拟合迭代中存在，这种表示在独立训练的模型之间是相似的。基于此，**我们可以将逆转换W'b+应用于从a空间移动到b空间**。由于W'是非方阵，我们**应用了伪逆转换W'b+**：![截屏2023-07-24 下午4.13.41](/Users/haozhipeng/Library/Application Support/typora-user-images/截屏2023-07-24 下午4.13.41.png)。方程7和8可以总结为一个步骤，**将节点i的嵌入从空间a转换到空间b**：𝑣𝑒𝑚𝑏𝑒𝑑𝑖𝑎,𝑏=𝑊𝑏′+T⋅(𝑊′T𝑎⋅𝑣𝑒𝑚𝑏𝑒𝑑𝑖𝑎,𝑎)（方程9）。

该**对齐方法不需要任何额外的学习或优化过程，而是依赖于在ANN内部已经学习到的变换**。

该方法**可以用于对齐来自独立拟合迭代的嵌入，这些嵌入可以在相同的结构连接矩阵上进行拟合，也可以来自不同个体的矩阵，或者是同一受试者在不同时间点的矩阵**。为了提高嵌入的稳定性，**超过拟合迭代的嵌入在对齐到相同空间后进行了平均化处理**（100次，除非另有说明)。



2.8. 个体内CE相似性评估

个体内节点对相似性，

在这一部分中，作者考察了**嵌入对齐对不同嵌入迭代中相同节点的相似性的影响**。首先，**对100名随机选取的个体样本运行node2vec算法多次（m = 50次）**，然后**将得到的向量对齐到一个共同的空间，并对它们进行平均**。**共同的参考空间是通过将node2vec算法应用于组内一致的结构连接矩阵得到的**。这个过程重复两次，并使用**余弦相似度量**化了**两个学习到的嵌入之间的节点嵌入相似性**【是两次，每次计算节点之间的相似性】。**相似性度量值对所有节点（DS1：200，DS2：233）进行了平均，并计算了所有个体的相似性。**接下来，作者评估了**独立拟合迭代产生的CE中节点对的余弦角度相似性。这是通过计算所有可能节点对的位移向量（即向量减法的结果）来实现的**（DS1：19900，DS2：27028）。类似地，**取自两个单独学习的CE的位移向量的余弦角度。相似性度量值对所有节点对进行了平均，并计算了所有个体的相似性**。在两个测试中，将相似性度量值与省略对齐步骤的情况进行了比较（“not-aligned”条件）。



2.9. 个体间CE相似性评估

为了**测试对齐的质量，作者应用了嵌入排名测试（Rosenthal et al., 2018）。首先，对每个个体进行多次node2vec迭代（m = 100次），将得到的嵌入对齐到共同空间（见2.7节）并进行平均**。然后，**对于一个个体中的每个节点，我们计算其与另一个个体中所有节点的余弦相似性**。**排名测试分数为k表示对于特定节点，其在第二个个体中的对应节点是k最相似的节点**。该测试对每个节点和所有可能的个体对（n = 100，9950对）进行了计算。最后，作者测试了**不同个体之间节点对之间关系的相似性**。这是通过使用类比排名测试来实现的。测试衡量的是**一个个体中从节点a到b的位移向量是否在另一个个体中表达了相同的关系**。在这种情况下，排名分数通过将从一个个体中取得的节点a到b的位移向量添加到另一个个体中的节点a，然后**查询结果是这个向量与第二个个体中节点b的接近程度**。这个测试对每个个体和节点对重复进行了k次计算（DS1：k = 200，DS2：k = 233）。因此，考虑到计算时间，分析是在较小的随机选择的个体样本（n = 30）上进行的。两个测试都与省略对齐步骤的情况进行了比较。



2.10. 个体间结构与功能映射

在这一部分，研究人员对来自测试集中所有受试者的共识结构和功能连接矩阵进行了结构与功能映射的分析。**功能组连接矩阵**是通过对所有受试者进行的Fisher-r-to-z转换后的相关性的平均得到的。在每个数据集中，**结构组共识连接矩阵**是通过对至少25%受试者中存在的所有边值进行平均得到的（de Reus和van den Heuvel，2013）。结构连接矩阵中所有其他节点对的边被假定不存在，并在共识平均中被设置为零。

**群体级共识嵌入（CE）通过将node2vec算法应用于结构组共识矩阵来创建**。结构-功能相关性通过计算结构连接矩阵中所有**唯一直接边（即存在于共识矩阵中的边）之间**的Spearman相关性来量化。**对于CE余弦边缘**，也采用了相同的相关性度量，但应用于**所有边缘，包括直接和间接边缘**。由于结构连接性值呈指数分布，所以使用**Spearman等级相关性作为度量。这个度量在后续的连接组水平结构-功能相关性评估中被使用**。

为了研究**个体边缘对增加的CE基于结构-功能映射**的贡献，研究人员采用了**留一试验法（Leave-One-Trial-Out）。这是通过计算CE余弦相似度边缘与相应功能边缘之间的Spearman等级相关性来实现的**。然后，**在去除每个边缘之后计算这种相关性的差异。这个差异即为去除边缘前后的相关性，或Δ相关性，可通过检查其符号和相对大小来了解特定边缘对整体相关性的影响**。



2.11. 随机游走参数及其与结构-功能映射的关系

在一个完全扩散的通信过程中，信号仅由局部连接性驱动在网络结构上传播（Avena-Koenigsberger等人，2018）。在**node2vec算法中，随机游走是有偏见的，并假设节点的局部邻域信息。两个参数指导有偏见的随机游走，即返回参数p和进出参数q**（Grover和Leskovec，2016）。具体来说，**参数p设置随机游走器立即重新访问节点的概率，即在时间t+1时它将占据在时间t-1时访问的同一节点。参数q控制随机游走器访问不直接连接到上一步访问节点的节点的概率，即在时间t+1它将与时间t-1访问的节点的边为0的节点进行步进。高p和低q会导向游走保持在初始起点的附近（局部偏见），相反则会促进探索远程节点（全局偏见）**。从节点t到t+1的非标准化转移概率计算为节点之间的权重，除以p（如果t-1 = t + 1）或q（如果t-1与t+1无连接）。在这里报告的所有分析中，我们**使用局部偏见的随机游走**（p = 0.1，q = 1.6；Rosenthal等人，2018）。此外，我们还研究了在CE余弦相似度矩阵和功能连接性矩阵之间观察到的相关性上调整p和q的效果。我们**针对具有功能和结构连接性度量的训练集（n = 25）中的随机选择受试者报告这个相关性。我们将此相关性分别报告给直接边和间接边**。参数化随机游走使用了参考node2vec Python实现（https://github.com/aditya-grover/node2vec。



2.12. 使用深度学习预测群体级功能连接性与结构连接性

之前的研究（Rosenthal等人，2018）表明，基于CE的结构-功能映射可以通过使用深度神经网络进一步改进。在这里，我们采用了相同的方法，其中将任意**一对节点嵌入的逐元素乘积用作输入，其功能连接性作为目标标签。**我们使用了一个完全连接的4层网络，每层有256个神经元。该网络是在Keras（François Chollet和贡献者，2015）和Tensorflow（Abadi等，2016）中实现的。训练使用了Adam优化器，学习率为0.001，共进行250个epochs。我们采用3折交叉验证，**将平均功能连接性矩阵的边缘随机划分为3个折叠**。在每个迭代中，**两个折叠用于拟合，剩下的折叠用于预测**。我们还在群体矩阵上应用了交叉验证，其中用于拟合的边缘和CE来自于训练集中的受试者，用于预测的CE来自于测试集中的受试者。最后，我们考虑了相同社区中的节点，这些社区由7个典型静息态网络（Yeo等人，2011）定义，具有相似的功能连接模式。因此，我们将3折交叉验证划分为不重复的两个社区交叉。例如，**所有连接一个视觉节点和一个运动节点的边仅出现在三个折叠中的一个中。这个方案用于创建了所有可能的功能边缘（直接和间接边缘）的CE预测**。



2.13. 个体水平的结构与功能映射

可以进一步**利用CE在个体水平上将结构连接性映射到功能连接性**。下面的分析针对那些接受了DWI和静息态扫描的个体进行，且在预处理阶段没有被排除（参见第2.3节；DS1：307和145，DS2：361和181；分别属于训练集和测试集的受试者）。结构-功能对应性使用测试集中的受试者进行评估，包括**结构连接性值和CE余弦相似度度量**。我们通过在**相关系数值之间进行成对样本t检验，检查CE与连接性值之间的结构-功能映射差异**。最后，我们应用相同的架构和超参数（见第2.10节）的深度学习模型来进行结构-功能映射。在边缘级别进行交叉验证和主题级别进行交叉验证。在边缘级别，我们采用了第2.12节中描述的相同的3折策略。在主题级别，模型拟合仅在训练集内进行，测试在测试集上进行。我们分别报告了**直接边、间接边和所有边的结构-功能连接性相关性**。

<img src="/Users/haozhipeng/Library/Application Support/typora-user-images/截屏2023-07-25 上午11.44.40.png" alt="截屏2023-07-25 上午11.44.40" style="zoom:50%;" />



图1展示了Connectome Embedding (CE) 框架的一般概述以及其在个体水平上的应用。

**a.i. 结构性连接组是CE模型的输入**。从加权结构性连接图中采样多个随机游走。字母表示两个半球中的所有唯一节点，虚线表示连接组中存在的边，有色线表示采样的随机游走。

a.ii. 对随机游走序列进行滑动固定大小的窗口操作。**在每个窗口内，将中心节点作为目标节点（黑色），其周围节点作为上下文（白色）。**

a.iii. 然后，将这些上下文和目标节点作为输入和目标（分别）输入到具有单个隐藏层的人工神经网络中。**输入和输出层是k维向量，其中k是大脑图中节点的数量。隐藏层，即嵌入层，是k'维向量，其中k'设置为k'<k。**圆圈的阴影表示它们的值，可以是二进制（黑色-1，白色-0）或连续的（灰色）。**W和W'是学习的权重矩阵，用于定义输入和嵌入层之间的转换，以及嵌入和输出层之间的转换。模型参数W和W'通过随机梯度下降进行迭代更新。拟合模型后，嵌入层节点表示构成节点嵌入**。

b.i. 在不同的个体中独立拟合模型（例如，不同主体或同一主体的独立嵌入），**导致节点嵌入具有相似的角度但不同的绝对值**。嵌入对齐是允许比较不同CE的必要步骤。

b.ii. 在此，**将嵌入从主体a的潜在空间（黄色）转换为主体b的潜在空间（蓝色），以便进行比较**。对于节点嵌入v，第一个下标i表示节点的索引，第二个下标表示源和当前主体的潜在空间。类似地，转换矩阵的下标表示其关联的主体，+ 表示伪逆。

c.i. **利用节点嵌入之间的相似性来进行结构性与功能性连接的映射**。

c.ii. 使用对齐的嵌入来进行**个体差异的预测**。

2.14. 个体水平结构-功能对应中与年龄相关的变化

先前的研究发现，**年龄与结构-功能连接性相关性的强度呈负相**关（Zimmermann等人，2016）。在这里，我们想要检查当**CE与功能连接性相关时，年龄与结构-功能关系之间的这种负相关是否保持。该相关性是针对测试集中的所有受试者计算的。结构-功能对应性仅使用Spearman等级相关性在直接边上进行评估**。通过使用Steiger的t检验来比较年龄对结构-功能对应性的影响大小（Steiger，1980；Python实现：https://github.com/psinger/CorrelationStats/）。为了**测试年龄与边缘结构-功能对应之间的关系，我们使用了第2.10节中描述的留一试验法。衡量单个节点对整体结构-功能关系的影响的贡献分数被应用于同一组受试者**。然后，我们测量**每个边缘与年龄在受试者之间的Pearson相关性。最后，我们采用了网络连续性分析方法。该方法检查来自七个典型静息态网络的子块是否呈现出大于预定阈值的边缘数，这些边缘与年龄相关的数量超过了通过排列测试定义的随机期望**。我们在多个阈值（|r| > 0.25、0.3、0.35、0.4）下重复了我们的分析。为了建立零分布，我们使用了10,000次年龄排列，只接受在排列后得到的相关性中没有一个比实际值更大的单元格（有关分析的完整描述，请参见附录8）。最后，我们检查了在7个典型功能网络内部或在半球之间，超阈值边缘是否显著大于或小于零。我们使用单样本t检验，零假设是总体均值为零。



2.15. 使用CE进行个体年龄和智力差异建模

为了测试**CE框架预测个体差异的能力，我们训练了一个线性模型来预测年龄和智力**。首先，**对每个节点和每种输入类型，即CE、CE余弦相似度矩阵、结构连接性值或功能连接性值，训练了一个单独的模型**。我们**使用CE余弦相似度矩阵、结构连接性矩阵、功能连接性矩阵的行以及节点的CE表示作为节点级别的输入**。模型的性能度量与使用结构连接性值或功能连接性值拟合的模型进行了比较。我们使用线性回归来预测年龄和智力。**模型的性能通过观测值与预测值之间的Pearson相关系数来量化**。此外，我们还报告了平均绝对误差（MAE）以及基于1000次数据标签置换的非参数检验的p值（Hilger等人，2020）。**年龄和智力预测的MAE以年为单位和智力测试分数为单位进行报告。**在连接组层次上，**通过取所有节点级别预测的平均值或在其上训练第二级集成模型来创建模型。由于第一级预测的高多重共线性，我们使用了SGD训练的L2正则化线性模型作为集成模型**。与第一级模型一样，在训练集内训练集合，并在测试集上进行测试。模型是在Statsmodels和Scikit-learn中实现的（linear_model.OLS; Seabold和Perktold，2010; SGDRegressor; Fabian等人，2011），使用默认参数。此外，我们还检查了结果是否受性别的可能影响，用于年龄预测，以及性别和年龄用于智力预测。**我们使用线性回归控制这两个变量，通过使用性别或年龄和性别作为预测因子来预测目标结果，保留残差。**

1. 结果

3.1. 个体CE对齐评估

之前的研究表明Node2vec算法可以捕获人类连接组的高阶结构关系（Rosenthal等人，2018）。将这种方法扩展到个体大脑网络需要将**个体连接组嵌入相互对齐，以便评估个体之间的差异**（图1）。以下部分评估了我们提出的嵌入对齐方法。为简洁起见，以下所有部分报告了NKI数据集（DS1）的结果，然后提供了Cam-CAN数据集（DS2）的缩写报告，仅包含统计数据，排除了文本部分（详见SI中DS2的完整报告）。

3.1.1. 个体内CE相似性评估

我们研究了**嵌入对齐对同一受试者的两个独立CE拟合迭代之间相似性的影响**。这是通过测试**相同节点对的余弦相似度**来实现的（SI图1a，i）。接下来，我们检查了**嵌入对齐对不同节点对之间关系的相似性的影响，同样是在同一受试者的两个独立拟合迭代之间。这些关系被量化为它们的位移向量之间的余弦相似度**（SI图2b，i）。 DS1：对于每个受试者（n = 100）**，测试了嵌入对齐对相同节点对**（200对）的平均余弦相似度的影响。**在应用嵌入对齐后，节点对的相似性显著提高**（t(199) = 111.14，p < 2.2e-16），余弦相似度为0.98 ± 0.001，而在对齐之前为0.92 ± 0.005。相反，不同节点对之间的关系在两次独立拟合迭代之间保持高度一致，无论在嵌入对齐之前（余弦相似度为0.99998 ± 2.7e-6）还是之后（余弦相似度为0.99992 ± 2.4e-5; SI图1b）。应用相同的方法在DS2上得到了类似的结果（t(232) = 118.31，p < 2.2e-16; 余弦相似度为0.96 ± 0.004; 余弦相似度为0.90 ± 0.005; 余弦相似度为0.9999 ± 8.7e-5; 余弦相似度为0.9998 ± 9.1e-5; 详见SI 2和SI图2a，b）。这些发现表明**对齐过程成功地减少了嵌入中的个体内方差。这是识别来自不同个体的CE嵌入差异的关键步骤。**

<img src="/Users/haozhipeng/Library/Application Support/typora-user-images/截屏2023-07-25 上午11.44.17.png" alt="截屏2023-07-25 上午11.44.17" style="zoom:50%;" />





图2显示了DS1数据集中结构性与功能性连接在群体和个体水平之间的关系。图a、b、c展示了群体水平上基于结构的连接和功能性连接的散点图和边缘单变量分布。图d显示了三种基于结构性连接的测量的个体水平结构-功能Spearman等级相关系数值。每条线代表单个主体的相关系数值（n = 181）。**发现CE余弦相似性与结构性连接相比，CE余弦相似性与功能性连接的相关性显著增加**。并且CE预测的功能性连接与CE余弦相似性相比，相关性也显著增加。

3.1.2. 个体间CE相似性评估

**嵌入对齐的目的是减少由node2vec拟合过程中的随机性产生的方差**。然而，由于个体之间的潜在脑解剖差异，我们并不期望在个体之间得到完全一致的对应关系。为了考虑这一点，我们采用了**更宽松的测试方法来估计个体间的CE相似性**，即嵌入排序测试（Rosenthal等人，2018）。使用排序测试，我们**检查了经过嵌入对齐后，不同个体之间的解剖学对应节点对是否比非对应节点对更相似。在该测试中，如果给定节点的另一个个体中最近的邻居是相同的解剖学对应节点，则该节点的排名为0**（SI图1c，i）。在所有分析中，通过余弦相似度来查询第i近的节点。DS1：对于每对可能的受试者（n = 100；共有9,950对），**我们测试了嵌入对齐对节点相似性排名分布的影响。在嵌入对齐之前，35.3% ± 37.1%的节点排在前2位，而在对齐后则有86.3% ± 4.6%**。在嵌入对齐后，节点排在前2位的百分比显著增加（t(9,949) = 135.7，p < 2.2e-16；详见SI图1c的完整分布）。在DS2中发现了类似的结果（n = 100；共有9,950对；10.8% ± 16.7%；52.7% ± 7.9%；t(9,949) = 246.6，p < 2.2e-16；详见SI 3和SI图2c）。

接下来，为了**测试节点关系的相似性，我们应用了类比排名测试**。该测试测量了在一个个体中，**从节点a到节点b的位移向量是否在另一个个体中表达了相同的关系**。我们以右前扣带回皮层（rACC）和右岛叶（rINS）的向量为例。在这种情况下，排名为0意味着个体a的rACC减去个体a的rINS再加上个体b的rINS的位移向量最接近个体b的rACC。DS1：类比测试对每对受试者（n = 30的子集）和节点对（870和39,800对）进行了测试。在嵌入对齐之前，23.3% ± 26.6%的节点排在前2位，而在对齐后则有71.0% ± 6.7%。这种差异是显著的（t(869) = 52.2，p < 2.2e-16；SI图1d）。在DS2中也有类似的结果（870和49,506对；4.1% ± 6.5%；31.2% ± 5.2%；t(869) = 104.7，p < 2.2e-16；详见SI 3和SI图2d）。

3.2. 使用CE映射结构连接性到功能连接性

静息态功能连接性指的是在**没有明确任务的情况下测量不同脑节点激活之间的时间统计依赖关系**。虽然这些共同激活模式依赖于结构连接性，**但结构连接性和功能连接性之间的观测到的相关性是中等程度的，仅捕获了观测到的方差的一部分**（Honey等人，2010；Suárez等人，2020）。**在个体水平上测试这种关系，而不是在群体水平上，进一步削弱了观察到的结构-功能对应关系**（Straathof等人，2019）。**CE框架被证明可以在群体水平上改善结构与功能连接性的映射，这可能是因为它能够捕获高阶图关系**（Rosenthal等人，2018）。在这里，我们首先复现这些发现，**并将这种方法扩展到个体内的结构-功能关系**。



<img src="/Users/haozhipeng/Library/Application Support/typora-user-images/截屏2023-07-25 下午12.22.27.png" alt="截屏2023-07-25 下午12.22.27" style="zoom:50%;" />





图3. 在DS1中CE基础的结构-功能映射中个体边缘的贡献。**个体边缘的贡献是基于去除每个边缘后测得的结构-功能相关性的差异进行评估**。(a) 所有边缘以矩阵形式展示。节点根据它们分属于7个标准静息态网络（Yeo等，2011）分别按照左右半球进行排序。蓝色表示对总体相关性有正向贡献的边缘，即去除这些边缘会导致相关性降低；红色表示对总体相关性有负向贡献的边缘，即去除这些边缘会导致相关性增加。(c) 边缘的Δ相关性分布图显示了直接对间接、以及在7个网络内对于7个网络之间的所有4种组合的情况。（对于该图例中颜色的解释，请参考本文的网络版本。）

在3.2.1节中，我们研究了**群体水平上结构性连接与功能性连接之间**的关系。我们使用Spearman等级相关系数来衡量它们之间的关联。由于结构性共识连接矩阵通常是稀疏的，因此在DS1和DS2中，仅有38.9%和18.9%的结构性连接边大于零。因此，我们只对**由结构性连接边（即直接边）连接的节点对之间的关联进行了计算，而未连接结构性连接边（即间接边）的节点对不计入计算**。此外，**我们还可以通过计算每对节点嵌入的余弦角来推导节点之间的结构关系。前人研究已经表明CE余弦相似性能够显著改进结构-功能映射，并且可以估计直接和间接边之间的关系，因为即使对于未重建连接的节点对，余弦角也可以进行量化。在DS1中，我们发现原始的直接结构性连接边与对应的功能性连接边之间存在显著相关性**（𝜌(7782) = .311, p < 2.2e-16; 见图4a）。当**使用CE余弦相似性代替结构性连接边时，结构-功能相关性显著增加**（𝜌(7782, 12114, 19898) = .345,.137,.282; 所有的p值都小于2.2e-16; 对于直接边、间接边和所有边，见图4b）。在DS2中也得到了类似的结果（𝜌(5032) = 0.287, p < 2.2e-16; 𝜌(5032, 21992, 27026) = .389,.256,.340; 所有的p值都小于2.2e-16; 详见SI 4和SI Fig. 5a,b）。

接下来，我们探讨了**每个个体边对CE基于结构性和功能性连接的映射的贡献**。由于**CE余弦矩阵与稀疏的原始结构性连接矩阵相比是稠密的，我们可以对每个唯一边进行估计。我们计算了去除每个节点后的结构-功能相关性，即Δ相关性**。**Δ相关性的结果告诉我们每个边对总体相关性的贡献的符号和相对大小。为了测试Δ相关性是否完全归因于功能性或CE余弦边值，我们将其与后两者的相关性进行了比较。我们比较了直接边与间接边以及在7个典型静息状态网络之间（Yeo等人，2011）内的边与之间的边的Δ相关性**（详见SI 4中每个网络的结果）。此外，我们还测试了**Δ相关性与节点之间的欧氏距离之间的关系。在DS1中，Δ相关性与CE余弦（𝜌(19898) = 0.242, p < 2.2e-16）和功能性连接值（𝜌(19898) = 0.167, p < 2.2e-16）之间存在显著但较弱的相关性**。**直接边的Δ相关性显著大于间接边**（Δ直接 = -5.34e-06 ± 3.7e-05，Δ间接 = -5.34e-06 ± 3.7e-05；t(19898) = 19.418，p < 2.2e-16）。**在典型网络内的边与之间的边的Δ相关性也显著大于间接边**（Δ内部 = 2.26e-05 ± 6.1e-05，Δ之间 = -4.09e-06 ± 4.5e-05；t(19898) = 28.303，p < 2.2e-16）。此外，我们发现这两个因素之间存在显著交互作用（F(3,19896) = 1018.535，p < 2.2e-16），即在网络内的边与之间的边对于直接边的增大效应较大（t(19898) = 39.943，p < 2.2e-16），而间接边的效应相反且较小（t(19898) = -16.586，p = 1.0e-08；见图3b）。**Δ相关性与节点之间的欧氏距离之间存在较小的相关性**（r(19898) = 0.057，p < 1.2e-15）。DS2中也得到了类似的结果（r(27026) = 0.107，p = <2.2e-16，r(27026) = 0.097，p < 2.2e-16；Δ直接 = 6.47e-06 ± 4.3e-05，Δ间接 = -1.48e-06 ± 3.5e-05；t(27026) = 13.897，p < 2.2e-16；Δ内部 = 1.21e-05 ± 4.7e-05，Δ之间 = -2.21e-06 ± 3.4e-05；t(27026) = 23.446，p < 2.2e-16；F(3,27024) = 762.826，p < 2.2e-16；t(27026) = 28.650，p < 2.2e-16；t(27026) = -8.132，p = 4.4e-16；r(27026) = 0.115，p < 2.2e-16；详见SI 4、SI Fig. 3c和SI 4b）。这些结果表明，**结构-功能对应主要受到直接的、在网络内的边的驱动。**



<img src="/Users/haozhipeng/Library/Application Support/typora-user-images/截屏2023-07-25 下午12.32.54.png" alt="截屏2023-07-25 下午12.32.54" style="zoom:50%;" />

在Fig. 4中，我们测试了**随机游走参数对DS1中结构-功能相关性的影响**。我们将随机游走参数从本地（p = 10^-3，q = 4.096）通过无偏（p = 1，q = 1）变化到全局（p = 10^3，q = 0.244），并分成20个相等的对数尺度区间。图中显示了直接边（蓝色）和间接边（灰色）与相应功能连接边之间的Spearman等级相关性。误差棒表示跨主体（N = 25）的标准偏差（对于颜色的解释，请参考文章的在线版本)。

<img src="/Users/haozhipeng/Library/Application Support/typora-user-images/截屏2023-07-25 下午12.38.58.png" alt="截屏2023-07-25 下午12.38.58" style="zoom:50%;" />

在Fig. 5中，我们研究了DS1中个体水平结构-功能相关性与年龄相关的变化。图中a部分显示了年龄与测得的连接组水平结构-功能相关性之间的回归图。每个主体的值分别用于结构边（SC"，灰色）和CE余弦边（CE，黄色）。底部显示了与年龄的相关性。结果表明，**CE余弦连接度量的结构-功能相关性与年龄之间的差异显著大于结构边。**

图中b部分显示了**年龄与结构-功能相关性的每个边的边际贡献得分之间的相关性。正的边表示增加与年龄的总体相关性（蓝色），负的边表示减少与年龄的总体相关性（红色）。**

图中c部分显示了网络相关性分析的结果，对于|r| > 0.25的边（所有阈值请参见SI图8）。**有色的单元格表示与年龄相关的边数比随机预期更多。单元格的背景颜色由与年龄正相关的边（蓝色）和与年龄负相关的边（红色）之间的比例确定**（对于颜色的解释，请参考文章的在线版本）。

<img src="/Users/haozhipeng/Library/Application Support/typora-user-images/截屏2023-07-25 下午12.39.15.png" alt="截屏2023-07-25 下午12.39.15" style="zoom:50%;" />



在Fig. 6中，我们**比较了CE、CE余弦相似性矩阵、结构连接和功能连接作为DS1中输入的预测准确性。图中显示了CE（蓝色）、CE余弦矩阵（蓝灰色）、结构连接（棕色）和功能连接（黄色）与年龄（a）和智力（b）的观察值与预测值之间的相关性**。在每个子图的左侧面板中，点表示每个7个静息状态网络（Yeo等人，2011）内每个节点的预测准确性。节点按其所属的静息状态网络进行分组。右侧面板显示了**通过取平均值（加号符号）或使用第二层线性模型（菱形符号）聚合所有个体节点的模型的预测准确性**。虚线表示单个节点预测的FDR校正显著性水平（对于颜色的解释，请参考文章的在线版本）。



3.2.2. 使用深度学习预测群体级功能连接与结构连接的改进

通过使用CE余弦相似性，我们**改进了结构连接到功能连接的映射，而无需优化该度量与功能连接相匹配**。在之前的研究中（Rosenthal等人，2018），我们进一步改进了这种映射，采用**深度学习模型，其中CE被用作预测功能连接的特征**。具体而言，我们**采用节点嵌入的逐元素乘积作为输入，预测标签为两者之间的观察功能连接**。我们**实现了一个4层全连接的神经网络，并使用交叉验证来评估预测性能（请参见方法部分）。在DS1中，预测的功能连接值与观察到的功能连接值之间的Spearman等级相关系数为𝜌(7782) = .641，𝜌(12114) = .527和𝜌(19898) = .599，分别对于直接边、间接边和所有边，所有p值均小于2.2e-16（请参见图2c）。在DS2中发现类似的结果（𝜌(5032) = .542，𝜌(21992) = .488和𝜌(27026) = .527；所有p值均小于2.2e-16；请参见SI 5和SI Fig. 5c）**。

3.2.3. 个体水平的结构-功能映射

接下来，我们测试了CE框架是否能够同样地用于**个体内**的结构-功能连接映射。我们使用**Spearman等级相关性在每个受试者中评估结构-功能一致性。我们首先使用直接边的结构连接值报告这种相关性，然后再使用直接和间接边的CE余弦相似性度量进行报告**。在DS1中，发现所有受试者的**直接结构边与相应的功能连接边之间存在显著相关性（𝜌 = .197 ± .031，所有p值 < 2.2e-16；请参见图2d）。与CE余弦相似性值的直接边的匹配结果显示出显著更高的相关性**（t(180) = 16.7，p < 2.2e-16）。在所有边的平均和标准差分别为𝜌 = .228 ± .048，𝜌 = .066 ± .035，𝜌 = .185 ± .037。在DS2中也发现了类似的结果（𝜌 = .152 ± .028，所有p值 < 2.2e-16；t(144) = 34.4，p < 2.2e-16；𝜌 = .245 ± .040，𝜌 = .102 ± .035，𝜌 = .181 ± .344；请参见SI 6和SI Fig. 5d）。

最后，与在群体级别相同，我们训练了一个深度学习神经网络，用于**从个体内对齐的CE中预测功能连接值。在DS1中，与结构连接边（t(180) = 66.0，p < 2.2e-16）和CE余弦相似性度量（t(180) = 53.4，p < 2.2e-16）相比，直接边的观察相关性显著增加**（请参见SI Fig. 3d）。预测的边的相关性与观察到的功能连接的相关性的均值和标准差分别为𝜌 = .397 ± .051，𝜌 = .253 ± .059，𝜌 = .337 ± .051，所有p值均小于2.2e-16。在DS2中也得到了相同的结果（t(144) = 52.8，p < 2.2e-16；t(144) = 34.5，p < 2.2e-16；𝜌 = .312 ± .043，𝜌 = .210 ± .051，𝜌 = .265 ± .046，所有p值均小于2.2e-16；请参见SI 6和SI Fig. 5d）。

3.2.4. 随机游走参数及其与结构-功能的关系

使用随机游走来学习大脑节点的嵌入与大脑中的扩散模型通信密切相关（Avena-Koenigsberger等人，2018）。在这里，我们**检查了由node2vec嵌入算法捕获的这种扩散过程如何建模结构连接与功能连接之间的关系。我们调整了随机游走的参数，使其更具全局或局部偏向性，并测量CE余弦矩阵与功能连接之间的观察相关性。随机游走的参数从最本地偏向（p = 10^-3，q = 4.096）通过无偏（p = 1，q = 1）变化到最全局偏向（p = 10^3，q = 0.244）**，在对数尺度上分为20个等间距步骤。所有结果均针对直接边、间接边和所有边分别进行展示。在DS1中，从最本地偏向（𝜌 = 0.128 ± 0.128，𝜌 = 0.007 ± 0.007，𝜌 = 0.061 ± 0.061）到无偏的随机游走（𝜌 = 0.253 ± 0.253，0.082 ± 0.082，0.200 ± 0.200），我们观察到**结构-功能映射的显著增加**（t(11.5) = -17.033，-7.987，-18.184；所有p值均小于3.25e-08）。而从最全局偏向的随机游走（𝜌 = 0.245 ± 0.245，0.068 ± 0.068，0.192 ± 0.192）移动到较小但显著的减少结构-功能映射（t(11.5) = -4.651，-5.564，-6.137；所有p值均小于1.01e-04；请参见图4）。在DS2中，当从最本地偏向到无偏的随机游走时，我们发现类似的增加，但在移动到最全局偏向的随机游走时没有显著差异（𝜌 = 0.202 ± 0.202，0.002 ± 0.002，0.049 ± 0.049；𝜌 = 0.267 ± 0.267，0.122 ± 0.122，0.202 ± 0.202；t(11.5) = -12.207，-20.914，-28.666；所有p值均小于8.76e-12；𝜌 = 0.262 ± 0.262，0.119 ± 0.119，0.200 ± 0.200；t(11.5) = -2.789，-1.402，-1.267；p = 0.010，0.174，0.217；请参见SI 7和SI Fig. 6）。

3.2.5. 个体水平的结构-功能相关性与年龄相关的变化

先前的研究报道了**结构-功能耦合与年龄相关的变化，但这些变化是在整个连接组**（Betzel等人，2014）或节点级别（Zimmermann等人，2016）上量化的。在这里我们将注意力集中在个体水平。

这些研究通过测试**年龄与结构-功能相关性之间的关系，来研究年龄对结构-功能映射的影响**。值得注意的是，该分析同时在网络水平和边水平上进行，通过应用我们的边贡献分数（第3.2.1节）来分析每个受试者。在DS1中，**使用结构边缘时发现了受试者年龄与结构-功能相关性之间的显著Pearson相关性**（r(179) = -.406，p = 1.4e-8），**使用CE余弦相似性时为r(179) = -.487，p = 3.6e-12（请参见图5a）。使用CE余弦相似性的相关性的观察增加是显著的（t = 2.621，p = 0.009）**。接下来，我们旨在**确定在年龄增长时对结构-功能相关性贡献增加或减少的边缘。我们计算了所有受试者的边缘贡献分数，并将每个边缘与年龄相关联**（图5b）。通过网络相关性分析，我们**发现了结构-功能贡献分数中广泛的与年龄相关的变化（图5c）。在对7个典型功能网络（Yeo等人，2011）内的边缘进行检查时，我们发现半球内的边缘随着年龄的增长普遍减少**（t值为6.94、5.58、3.02、1.66；p值为5.9e-12、2.82e-08、0.002、0.097；对于|r|阈值为0.25、0.3、0.35、0.4），**而半球间的边缘则增加**（t值为6.34、6.04、3.54、1.73；p值为3.03e-10、1.87e-09、4.14e-04、0.084；对于|r|阈值为0.25、0.3、0.35、0.4）。在功能网络之间发现了混合模式。在DS2中也得到了类似的结果：（r(144) = - .240，p = .003；r(144) = -.533，p = 5.3e-12；t = 4.9，p = 1.4e-5；t值为3.83、2.48、2.09、1.19；p值为1.3e-4、0.013、0.037、0.233；t值为14.7、12.9、11.1、9.04；所有p值均小于2.2e-16；请参见SI 8，SI Figs. 7和SI 9）。

3.3. 使用CE对个体差异进行建模

**产生个体级别的CE需要学习大脑节点的紧凑向量化表示，并将从不同个体获得的表示与相同的潜在空间对齐**。我们想要检查这些转换是否保留与个体差异相关的方差，并且使用CE表示连接组是否改善了我们估计这些个体差异的能力。具体而言，我们**在两个单独的数据集中使用CE对年龄和智力进行样本外预测。在之前的章节中，我们专注于结构-功能映射中与年龄相关的个体差异。在这里，年龄直接由CE进行预测。**

3.3.1. 使用CE捕获个体差异

**为了预测年龄和智力，我们使用线性回归，并使用CE和CE余弦矩阵作为输入**（请参见SI 9.5以查看未对齐CE的结果）。首先，在训练集中，我们使用5倍交叉验证来预测每个结果，将每个节点作为输入（请参见图6和SI Fig. 10）。然后，通过拟合第二级模型或取平均来合并个体节点的预测，并在保留的测试集上进行测试（请参见SI Figs. 11，12）。模型的性能由观察-预测年龄或智力之间的相关性和平均绝对误差（MAE）来衡量。在DS1中，**对于年龄，所有节点的平均观察-预测相关性为r = 0.464（± .078），MAE = 15.4（± 1.0），对于CE余弦矩阵为r = 0.468（± 0.057），MAE = 19.6（± 1.4）**。同样，**对于智力，CE的平均观察-预测相关性为r = 0.090（± .074），MAE = 24.0（± 0.5），对于CE余弦矩阵为r = 0.084（± 0.066），MAE = 38.3（± 2.4）**。在保留的测试集上进行验证的连接组模型显示出观察-预测年龄（CE：r(188) = 0.769，0.760；MAE = 10.5，13.6；余弦CE：r(188) = 0.826，0.746；MAE = 11.5，9.5；对于第二级模型和平均值，所有p值均小于2.2e-16）和智力（CE：r(188) = 0.377，0.230；MAE = 22.2，21.5；余弦CE：r(188) = 0.230，0.339；MAE = 26.5，20.9；对于第二级模型和平均值，除了CE余弦第二级模型的MAE是非显著的外，所有p值均小于0.008）。对DS2应用相同的分析产生了类似的结果（r = 0.410（± .087），MAE = 14.1（± 0.8）；r = 0.336（± 0.059），MAE = 21.0（± 1.5）；r = 0.219（± 0.075），MAE = 37.2（± 0.1）；r = 0.128（± 0.068），MAE = 8.8（± 0.7）；CE：r(199) = 0.717，0.787，MAE = 15.3，11.6；r(199) = 0.614，0.831，MAE = 15.6，8.8；所有p值均小于2.2e-16；r(199) = 0.547，0.586，MAE = 5.2，4.7；r = 0.434，0.576，MAE = 5.3，4.3；所有p值均小于0.008，除了CE余弦第二级模型是非显著的；请参见SI 9.1）。在两个数据集中，所有结果在控制性别后对年龄预测进行复制。在智力预测中控制年龄和性别，在DS1中复制了所有结果，而在DS2中观察到的效应减弱，仅对CE余弦矩阵作为输入的集成模型在显著性上是存在的（请参见SI 9.3）。

3.3.2. 使用CE相比结构连接和功能连接的预测准确性

接下来，我们检查使用**CE获得的预测准确性是否优于仅使用结构连接或功能连接作为输入**。我们对两个额外的输入重复了相同的步骤，并将**得到的性能与所有节点的CE**进行了配对t检验。在DS1中，**对于年龄，所有节点的平均观察-预测相关性为r = 0.155**（± 0.097），MAE = 132.2（± 1417.4），**对于结构连接性为r = 0.326（± 0.085）**，MAE = 22.9（± 2.3）。同样，**对于智力，结构连接的平均观察-预测相关性为r = 0.027（± 0.059）**，MAE = 176.6（± 1792.0），**对于功能连接为r = 0.044（± 0.069）**，MAE = 40.3（± 2.6）。使用CE和CE余弦矩阵相比，年龄和智力的观察-预测相关性都显著更高（所有t值（199） > 17.0，所有p值 < 2.2e-16）（所有t值（199） > 6.91，所有p值 < 6.6e-11）。在**保留的测试集上进行验证的结构连接连接组模型显示出年龄连接组水平的显著相关性**（r(188) = 0.582，MAE = 13.8，所有p值 < 2.2e-16），而其他模型均不显著（所有r值（188） < 0.084，所有p值 > 0.267）。**功能连接在将节点预测结果取平均时显示出显著相关性**（年龄：r(188) = 0.817，MAE = 9.3，所有p值 < 2.2e-16；智力：r(188) = 0.339，MAE = 20.9，p < 4.1e-06），但在第二级模型中不显著（所有r值（188） < 0.000；请参见图6）。将相同的分析应用于DS2产生了类似的结果（r = 0.026（± 0.062），MAE = 264.8（± 906.7）；r = 0.133（± 0.066），MAE = 58.1（± 10.1）；r = 0.007（± 0.059），MAE = 1217.9（± 15592.0）；r = 0.029（± 0.064），MAE = 30.6（± 5.5）；所有t值（232） > 16.7，所有p值 < 2.2e-16）（除了CE和功能连接：t(232)=34.4，p < 2.2e-16；所有t值（232） > 3.27，所有p值 < 0.002，除了余弦嵌入和功能连接：t(232) = -0.329，p = 0.743；所有r值（137） < -0.005，所有p值 > 0.953；请参见SI 9.2和SI Fig. 10）。**在两个数据集中，所有结果在控制性别后对年龄预测进行了复制。在智力预测中控制年龄和性别在DS1中复制了所有结果，但在DS2中没有（请参见SI 9.4）。这可能是由于DS2中既有结构数据又有功能数据的个体样本量较小**（425与601名受试者相比）。在SI 9.6中，我们包含了额外的分析，以检查与CE相比结构连接性能较低的可能原因及其与结构连接性稀疏性的关系。

1. 讨论

人类连接组的研究增进了我们对大脑神经处理和通信组织原则的理解。然而，观察到的个体差异在连接组拓扑和功能及行为的个体差异之间的关系仍然知之甚少。在当前的工作中，我们**利用CE框架来建模个体差异，通过将不同个体的嵌入对齐到共同的空间**。我们对我们的对齐方案进行了实证评估，并发现节点在受试者之间的相似性显著增加，表明成功对齐了个体连接组嵌入。然后，我们展示了在个体受试者级别应用CE框架的两个贡献。第一个是在**保留与结构-功能对应相关的年龄相关方差的同时**，改进了结构到功能连接的主观级别映射。第二个贡献是**成功使用对齐的CE来预测人口统计和行为变量。与仅使用结构或功能连接相比，CE显著提高了对年龄和智力的预测性能，这表明CE不仅保留了与人口统计和行为相关的可变性，而且强调了这种可变性，使其更易于用于基于预测的模型**。

4.1. CE对齐

使CE相互对齐是利用机器学习技术进行后续任务的必要步骤，例如预测功能连接或神经学疾病的存在。在这里，我们考虑两个问题可能通过适当的CE对齐得到帮助。**第一个问题是找到基于其拓扑属性来自一个连接组的节点与另一个连接组的节点之间的最佳一对一映射**。例如，这样的映射可用于在不同物种之间找到同源的脑结构。第二个问题涉及在相同潜在空间中对齐连接组的向量化表示，以便进行比较。在这里，与连接组中对应节点的映射是预先已知的，我们感兴趣的是由于CE拟合过程中的随机性差异和不同潜在空间而引起的这些向量化表示的细微变化。目标是消除与CE拟合过程和不同潜在空间相关的可变性，并保留与底层网络拓扑变化相关的可变性。虽然第一个问题在先前的应用中已得到解决，例如在不同语言之间的翻译（Smith et al.，2017）中，据我们所知，第二个问题尚未得到解决。我们认为我们的CE对齐方法还可以用于语言任务，例如作者归属（Kocher和Savoy，2018）或研究不同文化中词语语义差异（Karimi等，2015）。值得注意的是，我们的方法在计算效率上是高效的，因为当遇到新样本时，不需要共同学习所有嵌入（Wolf等，2014），这使其在临床应用中更受欢迎。





4.2. 将结构连接映射到功能连接

**群体层面上观察到的结构连接与功能连接之间的相关性通常是中等程度的（r = 0.3-0.5；Suárez等，2020）。部分原因是中等相关性可能反映了数据采集和重建的限制，以及相同的结构骨架支持大量动态功能相互作用的事实**（Deco等，2013；Fukushima等，2018）。然而，考虑节点之间的高级结构相互作用可能能够解释更大部分的功能连接变异。在当前的工作中，我们展示了使用深度学习模型，可以从CE中预测功能连接，同时在群体层面显著改进结构-功能映射（DS1：𝜌 = 0.64，DS2：𝜌 = 0.54）。 在个体受试者级别上观察到的结构-功能相关性通常比群体层面的估计更适度（r = 0.02-0.25；Straathof等，2019），可能是由于不同成像模态的采集噪声，短时间扫描中静息态动态的欠采样（Birn等，2013），以及个体之间功能边界的变异性（Gordon等，2017）。将**CE方法应用于类似的个体层面映射会显著提高结构-功能相关性**（DS1：𝜌 = 0.397，DS2：𝜌 = 0.312）。此外，CE还为没有连接纤维的节点对产生了边缘相似性度量。这使得对结构-功能对应的边缘贡献有了更全面的估计。我们的结果表明，**特定的边缘子集（规范静息态网络内的直接边缘）驱动了观察到的结构-功能相关性。最后，我们展示了CE保留甚至增强了与年龄相关的个体差异在结构-功能映射中的作用。**

4.3. CE作为连接结构与功能的通信模型

CE可能推动我们对大脑中通信性质的理解。大脑网络中的通信或信息流可以被视为神经元元素之间所有动态因果影响的完整集合（Avena-Koenigsberger等，2018）。根据这种观点，通信受到结构连接支撑的限制，并导致观察到的脑区对之间的共振（功能连接），从而在两者之间建立了联系。大脑区域之间的通信过程模型范围**从信息的扩散流动（例如随机游走）到基于最短路径的路由机制。基于一组随机游走来拟合的CE可以被看作是节点周围扩散性通信的生成模型**。它们的成功表明，**扩散性模型可能更好地捕捉观察到的功能连接**（Goni等，2014）。进一步操作用于拟合CE模型的特定随机游走参数，**表明无偏或略带局部偏差的随机游走最能解释观察到的功能连接**。在未来的工作中，可以基于不同机制（例如最短路径）生成抽样游走，并测试它们与相应嵌入与静态或动态连接性之间的关系。

4.4. 使用对齐CE预测个体差异

跨受试者对齐，无论是基于解剖学（Frost和Goebel，2012）还是功能（Haxby等，2020），都是突出显示大脑映射个体差异的关键步骤。在这里，我们将个体差异的表征视为CE对齐方法的理想测试案例。事实上，我们发现**与结构连接相比，对齐的CE以及CE余弦相似度矩阵在个体节点和整个连接组水平上都显示出稳健的预测准确性提高**（年龄和智力方面）。这种**预测准确性的增加可能归因于结构连接矩阵的稀疏性和维数，以及其无法捕捉高阶拓扑关系。这些可能解释了为什么尽管有越来越多的研究关注个体差异**（Sui等，2020），但迄今为止，相对于其他模态（如功能连接），应用预测建模于结构连接数据的研究较少（Arbabshirani等，2017）。我们的CE框架通过学习低维的节点表示并保留节点的拓扑上下文而不仅仅是其直接连接来解决这些问题。**当以余弦相似度矩阵的形式展示时，它捕捉了节点之间的所有成对关系，从而产生了密集的矩阵表示。除了在表示结构连接方面的这种优势之外，CE可以被视为大脑通信的模型。因此，它除了表示结构外，还表示了大脑连接的功能方面。这可能解释了CE在节点级别或连接组级别模型的相似性中相比功能连接的优势。需要指出的是，功能连接只在其中一个连接组级别模型（节点平均值）方面显示出类似结果**。因此，CE框架可能有望推动将连接组映射应用于这种预测模型的发展。未来的工作可以利用**CE预测框架研究神经发育状况下的连接组变化。此外，我们可以在嵌入过程之前通过清零连接或整个节点等方式来研究对网络的“损伤”，然后可以测试这些“损伤”对这种预测模型中预测结果的影响**（Rosenthal等，2018）。

4.5. 结论

我们的研究结果表明，学习的连接组表示及其相互对齐是对结构连接与功能和行为进行个体层面映射的强大工具。我们对CE提出了两种互补的观点。第一种是改进的结构连接表示，允许量化网络重建中缺失的结构关系。第二种是作为结构背景上扩散通信的代理，因此结合了结构（结构图）和功能（扩散过程）的方面。CE框架中的进展支持了当前神经科学对于更好地理解和处理个体差异的努力。