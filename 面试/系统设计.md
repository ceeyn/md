

### 短链接系统

https://xie.infoq.cn/article/7e4023d2080d676addbe0e2b0?utm_campaign=geek_search&utm_content=geek_search&utm_medium=geek_search&utm_source=geek_search&utm_term=geek_search



<img src="/Users/moon/Library/Application Support/typora-user-images/截屏2024-09-27 21.55.57.png" alt="截屏2024-09-27 21.55.57" style="zoom:50%;" />



## 全局唯一id

## Snowflake ID 的结构（64 位整数）

```
plaintext


复制编辑
1bit   |   41bits     | 10bits     | 12bits
符号位 | 时间戳部分   | 机器标识   | 序列号
```

总共 64 位（Java `long` 类型），各部分详解如下：

| 部分     | 位数 | 作用                                             |
| -------- | ---- | ------------------------------------------------ |
| 符号位   | 1    | 恒为 0（Long 的最高位，正数）                    |
| 时间戳   | 41   | 当前时间戳（相对于某个起始时间），单位：毫秒     |
| 机器标识 | 10   | 唯一标识某个生成节点（如机房 + 机器号）          |
| 序列号   | 12   | 同一毫秒内自增的计数器（最多支持 4096 个 ID/ms） |

### 本地时钟错误：引入逻辑时钟（Logical Clock）+ 版本号

> 类似百度的 UIDGenerator、滴滴的 TinyId 会采用这个方法

#### 📌 做法：

在时间戳前面加一个“逻辑版本号”或“业务周期号”：

```
plaintext


复制编辑
| 7位逻辑时钟 | 28位时间戳 | 10位机器号 | 17位序列号 |
```

- 当检测到系统时钟回拨，**逻辑时钟（epoch）+1**，时间戳部分归 0
- 即使时间变小，也能保证最终 ID 仍递增、唯一

#### ✅ 优点：

- 能安全容忍时钟回拨
- 不阻塞业务（逻辑时钟只在回拨时跳一次）

#### ❌ 缺点：

- 实现复杂
- ID 结构不兼容传统 Snowflake





# 抢红包

https://blog.csdn.net/xiaofeng10330111/article/details/130191645?ops_request_misc=%257B%2522request%255Fid%2522%253A%25226B983A95-DA90-4287-9708-B8B47A07BC2C%2522%252C%2522scm%2522%253A%252220140713.130102334.pc%255Fall.%2522%257D&request_id=6B983A95-DA90-4287-9708-B8B47A07BC2C&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2~all~first_rank_ecpm_v1~hot_rank-3-130191645-null-null.142^v100^pc_search_result_base8&utm_term=红包系统&spm=1018.2226.3001.4187

<img src="/Users/moon/Library/Application Support/typora-user-images/image-20241007122244309.png" alt="image-20241007122244309" style="zoom:50%;" />

## 服务set化



<img src="/Users/moon/Library/Application Support/typora-user-images/image-20241007122443706.png" alt="image-20241007122443706" style="zoom:50%;" />
