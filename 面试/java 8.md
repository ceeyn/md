



## 匿名内部类

**匿名内部类是 Java 的一种语法糖**，可以**继承类**或**实现接口**。

**本质上是编译器自动创建的一个子类**，并在`new` 时**直接实例化**

在使用**回调（callback）、事件监听、线程任务等**场景时，需要创建一个**短小的类**，用于实现某个接口或继承某个父类。但如果为此专门定义一个单独的类，会显得**冗长**且**增加代码复杂度**

 **为什么 Java 限制 Lambda 只能捕获 final 变量？**

java 的匿名内部类访问外部变量时，实际上是访问变量的副本，而不是原始变量本身

Java 这样设计的核心原因是 **避免数据不一致**，特别是在**多线程环境下**。

如果允许 Lambda **修改局部变量**，就会引发**以下问题**：

- **局部变量存储在栈中**，但 Lambda 可能在线程池中运行，Lambda 内部**只能访问局部变量的副本**，无法访问原来的变量。
- 如果 Lambda **在另一个线程执行**，但外部变量已被销毁或修改，Lambda 可能访问到无效的数据（悬空引用）。
- **Java 设计者为了保证数据一致性**，决定 **Lambda 只能访问 final 或 effectively final 变量**，以避免意外的数据修改。







 **Lambda 不能修改基本类型变量**，但**可以修改对象的属性**，我们可以用 **数组** 或 **`AtomicInteger`** 作为可变引用

Lambda 可以修改对象的属性，因为对象的引用未变，但其内部状态可以改变

**Java 允许 Lambda 修改对象的属性**，因为即使方法返回，**对象仍然存在于堆内存中**，不会被销毁