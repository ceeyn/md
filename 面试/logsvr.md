



logsvr  类似于一个数据上报和日志平台，腾讯会议的多个业务，客户端，后台会上报过来数据，我们按照事件进行埋点，例如参加会议，离开会议，举手，发言等事件，多个业务上报上来以后，我们按照规则进行处理后然后根据策略转发到下游的大数据处理平台 tabank，atta，kafka，不同的事件有不同的处理规则和转发的目的地

我主要做了根据不同的规则进行加密转发，实现了加密策略的动态配置与监听



使用bitmap代替人群id集合作为腾讯会议人群包，提高存储和运算的效率。

调研多种业务id到bit位的映射方案，结合业务场景最终选取查表映射的方式。

针对人群包过大形成大key和roaringbitmap的api支持不好的问题，采用分段存储运算的方式提高业务id的判存和分页拉取效率。

针对腾讯会议的不同多端上报数据，设计加密转发策略能够根据不同规则进行加密转发，实现了加密策略的动态配置

```
{
    "client": [
        {
            "id": 1,
            "comment": "腾讯企业客户端：私参使用TXGCbcKey加密",
            "isTencent": true,
            "condition": {
                "fields": [],
                "rule": "true"
            },
            "action": {
                "public": {
                    "key": "",
                    "fields": []
                },
                "private": {
                    "key": "TXGCbcKey",
                    "fields": [
                        "meeting_subject", "subject", "nick_name", "nickname", "src_user_name", "tar_user_name",
                        "nick_name_0", "old_nick_name_0", "creator_nick_name", "phone", "phone_number", "phone-number", "tar_phone",
                        "src_phone", "phone_id_0", "email", "tar_email", "src_email", "rooms_report_issue_user_emails"
                    ]
                }
            }
        },
```



#### 通过 API key 来保证其他服务使用密钥 id 获取不到真正的密钥

腾讯云通过统一的身份认证系统，对每个请求进行严格的鉴别。只有经过认证的客户端才能获得密钥，确保非授权客户端无法通过冒充获取密钥。

API Key 是调用云端服务的重要凭证。系统需要对其使用权限进行细粒度的控制，例如哪些用户或客户端可以使用该密钥调用哪些服务，调用范围是否受到限制（如 IP 限制、时间限制等）

```
假设有一个应用需要调用腾讯云的对象存储（COS）服务。管理员为该应用生成了一个 API Key，并通过细粒度权限控制实现以下限制：

​	1.	**调用范围**：

​	•	该 API Key 只能访问 COS 服务，无法调用其他服务（如数据库或服务器管理）。

​	2.	**服务实例**：

​	•	只能操作某个特定的存储桶（如 my-bucket），无法访问其他存储桶。

​	3.	**IP 限制**：

​	•	该 API Key 只能由 192.168.1.1（某台服务器）发起请求使用，其他 IP 发起的请求会被拒绝。

​	4.	**时间限制**：

​	•	该 API Key 只能在工作日（周一到周五）9:00 - 18:00 有效，其他时间无法使用。

​	5.	**请求频率**：

​	•	该 API Key 的请求频率限制为每分钟最多 100 次。



如果某个攻击者窃取了该 API Key，但从其他 IP 地址、在非工作时间尝试使用，或者请求超出了频率限制时，请求都会被腾讯云拒绝。
```

