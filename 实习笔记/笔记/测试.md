

cd /home/oicq/backend_report_kafka_other/conf/



## 客户端、web接口测试

<img src="/Users/giffinhao/Library/Application Support/typora-user-images/image-20240819180222283.png" alt="image-20240819180222283" style="zoom:50%;" />

![image-20240819180539491](/Users/giffinhao/Library/Application Support/typora-user-images/image-20240819180539491.png)

## **后台接口测试**

### 测试腾讯企业 创建会议的私参

curl -X POST http://30.188.181.104:39004/api/server-report-standard \
    -H "Content-Type: application/json" \
    -d '{
        "request_time": 1690214725006,
        **"event_code": "e#create_meeting",**
        "comm_params": {
            **"corp_id": "1400115281",**
            "meeting_code": "meeting456",
            "product": "meeting",
            "source_id": "2",
            "user": "forestfu",
            "uid": "123",
            "ip": "10.64.35.55",
            "creator_corp_id": "1400143280",
            "creator_uid": "1400143280"
        },
        "event_value": {
            "getParams": "{\"corp_ids\":\"1400115280\"}",
            "postParams": "[]",
            "response": "[{\"corp_id\":\"1400115281\",\"status\":1}]",
            "creator_corp_id": "1400143280",
            "creator_uid": "1400143280",
            "uid": "123",
            "meeting_subject": "aaa",
            "subject": "test_subject",
            "nick_name": "test_nick_name",
            "nickname": "test_nickname",
            "src_user_name": "test_src_user_name",
            "tar_user_name": "test_tar_user_name",
            "nick_name_0": "test_nick_name_0",
            "old_nick_name_0": "test_old_nick_name_0",
            "creator_nick_name": "test_creator_nick_name",
            "phone": "1234567890",
            "phone_number": "0987654321",
            "phone-number": "1122334455",
            "tar_phone": "2233445566",
            "src_phone": "3344556677",
            "phone_id_0": "4455667788",
            "email": "test@example.com",
            "tar_email": "tar_test@example.com",
            "src_email": "src_test@example.com",
            "rooms_report_issue_user_emails": "issue_report@example.com"
        },
        "client_ip": "192.168.1.1",
        "client_params": {
            "client_param1": "value1"
        },
        "server_params": {
            "server_param1": "value1"
        },
        "version": "1.0"
    }'

<img src="/Users/giffinhao/Library/Application Support/typora-user-images/image-20240819180324168.png" alt="image-20240819180324168" style="zoom:50%;" />

### 测试腾讯企业 不创建会议的私参且creatorcorp等于指定值

curl -X POST http://30.188.181.104:39004/api/server-report-standard \
    -H "Content-Type: application/json" \
    -d '{
        "request_time": 1690214725000,
        **"event_code": "security_access_log",**
        "comm_params": {
            **"corp_id": "1400115284",**
            "meeting_code": "meeting456",
            "product": "meeting",
            "ip": "10.64.35.99",
            "source_id": "2",
            "user": "forestfu",
            "uid": "123",
            "creator_uid": "1400143284"
        },
        "event_value": {
            "getParams": "{\"corp_ids\":\"1400115280\"}",
            "postParams": "[]",
            "response": "[{\"corp_id\":\"1400115281\",\"status\":1}]",
            **"creator_corp_id": "1400115281",**
            "creator_uid": "1400143284",
            "uid": "123",
            "meeting_subject": "aaa",
            "subject": "test_subject",
            "nick_name": "test_nick_name",
            "nickname": "test_nickname",
            "src_user_name": "test_src_user_name",
            "tar_user_name": "test_tar_user_name",
            "nick_name_0": "test_nick_name_0",
            "old_nick_name_0": "test_old_nick_name_0",
            "creator_nick_name": "test_creator_nick_name",
            "phone": "1234567890",
            "phone_number": "0987654321",
            "phone-number": "1122334455",
            "tar_phone": "2233445566",
            "src_phone": "3344556677",
            "phone_id_0": "4455667788",
            "email": "test@example.com",
            "tar_email": "tar_test@example.com",
            "src_email": "src_test@example.com",
            "rooms_report_issue_user_emails": "issue_report@example.com"
        },
        "client_ip": "192.168.1.1",
        "client_params": {
            "client_param1": "value1"
        },
        "server_params": {
            "server_param1": "value1"
        },
        "version": "1.0"
    }'

![image-20240819180352786](/Users/giffinhao/Library/Application Support/typora-user-images/image-20240819180352786.png)

### 测试腾讯企业 不创建会议的私参且creatorcorp不等于指定值

curl -X POST http://30.188.181.104:39004/api/server-report-standard \
    -H "Content-Type: application/json" \
    -d '{
        "request_time": 1690214725000,
        **"event_code": "security_access_log",**
        "comm_params": {
            **"corp_id": "1400115284",**
            "meeting_code": "meeting456",
            "product": "meeting",
            "ip": "10.64.35.99",
            "source_id": "2",
            "user": "forestfu",
            "uid": "123",
            "creator_uid": "1400143284"
        },
        "event_value": {
            "getParams": "{\"corp_ids\":\"1400115280\"}",
            "postParams": "[]",
            "response": "[{\"corp_id\":\"1400115281\",\"status\":1}]",
            **"creator_corp_id": "1400115284",**
            "creator_uid": "1400143284",
            "uid": "123",
            "meeting_subject": "aaa",
            "subject": "test_subject",
            "nick_name": "test_nick_name",
            "nickname": "test_nickname",
            "src_user_name": "test_src_user_name",
            "tar_user_name": "test_tar_user_name",
            "nick_name_0": "test_nick_name_0",
            "old_nick_name_0": "test_old_nick_name_0",
            "creator_nick_name": "test_creator_nick_name",
            "phone": "1234567890",
            "phone_number": "0987654321",
            "phone-number": "1122334455",
            "tar_phone": "2233445566",
            "src_phone": "3344556677",
            "phone_id_0": "4455667788",
            "email": "test@example.com",
            "tar_email": "tar_test@example.com",
            "src_email": "src_test@example.com",
            "rooms_report_issue_user_emails": "issue_report@example.com"
        },
        "client_ip": "192.168.1.1",
        "client_params": {
            "client_param1": "value1"
        },
        "server_params": {
            "server_param1": "value1"
        },
        "version": "1.0"
    }'

![image-20240819180420673](/Users/giffinhao/Library/Application Support/typora-user-images/image-20240819180420673.png)



### 测试非腾讯企业

curl -X POST http://30.188.181.104:39004/api/server-report-standard \
    -H "Content-Type: application/json" \
    -d '{
        "request_time": 1690214725000,
        "event_code": "security_access_log",
        "comm_params": {
            **"corp_id": "1400115285",**
            "meeting_code": "meeting456",
            "product": "meeting",
            "ip": "10.64.35.55",
            "source_id": "2",
            "user": "forestfu",
            "uid": "123",
            "creator_corp_id": "1400143287",
            "creator_uid": "1400143280"
        },
        "event_value": {
            "getParams": "{\"corp_ids\":\"1400115281\"}",
            "postParams": "[]",
            "response": "[{\"corp_id\":\"1400115281\",\"status\":1}]",
            "creator_corp_id": "1400143287",
            "creator_uid": "1400143280",
            "uid": "123",
            "meeting_subject": "aaa",
            "subject": "test_subject",
            "nick_name": "test_nick_name",
            "nickname": "test_nickname",
            "src_user_name": "test_src_user_name",
            "tar_user_name": "test_tar_user_name",
            "nick_name_0": "test_nick_name_0",
            "old_nick_name_0": "test_old_nick_name_0",
            "creator_nick_name": "test_creator_nick_name",
            "phone": "1234567890",
            "phone_number": "0987654321",
            "phone-number": "1122334455",
            "tar_phone": "2233445566",
            "src_phone": "3344556677",
            "phone_id_0": "4455667788",
            "email": "test@example.com",
            "tar_email": "tar_test@example.com",
            "src_email": "src_test@example.com",
            "rooms_report_issue_user_emails": "issue_report@example.com"
        },
        "client_ip": "192.168.1.1",
        "client_params": {
            "client_param1": "value1"
        },
        "server_params": {
            "server_param1": "value1"
        },
        "version": "1.0"
    }'

![image-20240819180446916](/Users/giffinhao/Library/Application Support/typora-user-images/image-20240819180446916.png)



## 成功加密后

<img src="/Users/giffinhao/Library/Application Support/typora-user-images/image-20240819174549016.png" alt="image-20240819174549016" style="zoom:50%;" />

### 发给下游tdbank的时候正确发送

![image-20240819174737262](/Users/giffinhao/Library/Application Support/typora-user-images/image-20240819174737262.png)

### **发给下游atta的时候正确发送**

<img src="/Users/giffinhao/Library/Application Support/typora-user-images/image-20240819180107012.png" alt="image-20240819180107012" style="zoom:50%;" />





```
{
  "client": [
    {
      "id": 1,
      "comment": "client1：腾讯企业客户端：私参使用TXGCbcKey加密",
      "isTencent": true,
      "condition": {
        "fields": [],
        "rule": "true"
      },
      "action": {
        "public": {
          "fields": []
        },
        "private": {
          "fields": [
          ]
        }
      }
    },
    {
      "id": 2,
      "comment": "client2：非腾讯企业客户端：私参使用GCGbcKey加密",
      "isTencent": false,
      "condition": {
        "fields": [],
        "rule": "true"
      },
      "action": {
        "public": {
          "fields": []
        },
        "private": {
          "fields": []
        }
      }
    }
  ],
  "server": [
    {
      "id": 1,
      "comment": "server1：腾讯企业后台event_code等于create_meeting：公参和私参使用TXGCbcKey加密",
      "isTencent": true,
      "condition": {
        "fields": [
          {
            "name": "event_code",
            "type": "string"
          }
        ],
        "rule": "event_code == 'create_meeting'"
      },
      "action": {
        "public": {
          "fields": ["uid", "meeting_code"]
        },
        "private": {
          "fields": [
            "meeting_subject"
          ]
        }
      }
    },
    {
      "id": 2,
      "comment": "server2：腾讯企业后台event_code不等于create_meeting，且creator_corp_id等于指定值：公参和私参使用TXGCbcKey加密",
      "isTencent": true,
      "condition": {
        "fields": [
          {
            "name": "creator_corp_id",
            "type": "string"
          }
        ],
        "rule": "creator_corp_id == '1400115281'"
      },
      "action": {
        "public": {
          "fields": ["uid", "meeting_code"]
        },
        "private": {
          "fields": [
            "creator_uid"
          ]
        }
      }
    },
    {
      "id": 3,
      "comment": "server3：腾讯企业后台event_code不等于create_meeting，且creator_corp_id不等于指定值：公参和私参使用TXGCbcKey加密",
      "isTencent": true,
      "condition": {
        "fields": [
          {
            "name": "creator_corp_id",
            "type": "string"
          }
        ],
        "rule": "creator_corp_id != '1400115281'"
      },
      "action": {
        "public": {
          "fields": ["uid", "meeting_code"]
        },
        "private": {
          "fields": [
            "meeting_subject"
          ]
        }
      }
    },
    {
      "id": 4,
      "comment": "server4：非腾讯企业后台：公参和私参使用GCGbcKey加密",
      "isTencent": false,
      "condition": {
        "fields": [],
        "rule": "true"
      },
      "action": {
        "public": {
          "fields": ["uid", "meeting_code"]
        },
        "private": {
          "fields": [
            "meeting_subject", "subject", "nick_name", "nickname", "src_user_name", "tar_user_name"
          ]
        }
      }
    }
  ]
}
```

