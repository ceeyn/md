# 利用MRI数据探索要素相似性梯度的教程和工具

## 摘要

人们越来越有兴趣使用不同的MRI特征，如结构或功能连接，来研究大脑皮层(和皮质下区域)的组织原理。<br>尽管有广泛的兴趣，但针对神经成像新手的基本技术的入门教程在文献中是解析的。研究各种“神经梯度”的文章(例如，基于区域研究的“皮质梯度”、“小脑梯度”、“海马区梯度”等或感兴趣的特征“功能梯度”、“细胞结构梯度”、“髓结构梯度”等)。<br>都变得越来越受欢迎。<br>因此，我们认为现在是讨论“梯度分析”一般含义的时候了。<br>我们介绍了图论中的基本概念，如图本身、度矩阵和邻接矩阵。<br>我们讨论了如何使用**图论来思考特征相似性的梯度(fMRI中的时间序列之间的相似性，或跟踪图中的流线)，并将其扩展到整个MRI范围内；从体素水平到整个大脑水平。**<br>我们接着介绍了一种**量化感兴趣区域相似性水平的方法**。<br>我们提出了**“Vogt-Bailey指数”这一术语来表示对我们作为脑图社区的历史的敬意**。我们在样本数据集上运行了这些技术，作为在真实数据上应用技术的例子，并提供了几个附录来详细展开。<br>为了最大限度地提高直觉，附录中包含了一个说明性的例子，描述了如何使用这些技术来解决人们在结合上可能遇到的特别有害的问题。<br>本文附带了一个工具，该工具在MatLab和Python中均可用，它使读者能够对自己的数据执行本文中描述的分析。我们建议读者参考图形摘要，作为本文中呈现的分析管道的概述。



## 介绍

大脑中的每个离散点(在磁共振成像的背景下被建模为体素或顶点)都有几个共存的特征，如细胞结构、功能特征、受体密度等……**分割是描述神经特征及其相似性的一种方法。<br>这项技术将具有相似特征的大脑区域组合在一起。**<br>现代神经科学中最广为人知的名字之一是科尔比尼·布罗德曼和他的细胞建筑学--20世纪初的大脑皮层

Brodmann‘s区试图**定义大脑皮层局部细胞结构同质性的区域**。<br>不幸的是，在神经成像研究中使用这些区域的便利是要付出高昂代价的。<br>首先，Brod-Mann**区域是在组织学上定义的，并不一定与MRI上可见的大体解剖标志相对应**(Zilles和Amunts，2010)。<br>其次，布罗德曼的图谱当然不是关于什么构成细胞结构脑包的最终结论。<br>他的近代人(von Economo和Koskinas，1925年)以及目前的研究人员(Amunts等人，2005；Bludau等人，2014；Caspers等人，2013,2006；Rottschy等人，2007；Scheperjans等人，2008)仍在研究和提炼细胞结构分隔。<br>第三，**细胞结构并不是唯一可以区分大脑皮层的特征**。例如，自Brod-Mann时代(Geyer和Turner，2013；Nieuwenhuys等人，2015；Vogt和Vogt，1911)以来一直使用脊髓结构，最近使用了大量的神经成像特征

第四，**以任何特定特征为特征的区域之间的边界有时可能是清晰的，而有时它们可能是模糊的**(Bailey和Von Bonin，1951；Brodmann，1909；Glasser等人，2016)。
最后，**不同的“不同”区域也可能与其他区域共享一些关系，从而在整个大脑皮层上呈现出非随机的模式；例如，涉及静息状态网络的功能区**



在20世纪50年代，珀西瓦尔·贝利和格哈特·冯·博宁提出了另一种相互竞争的皮质组织概念。<br>从表面上看，沃格特和贝利可以被认为是在阐述相反的观点。<br>虽然支持皮质分离的沃格特、贝利和冯·博宁(1951)认为**等皮质(或新皮质--六层皮质)在整个范围内更相似，而不是不同**。他们甚至指出：



根据许多**具有不同区别和意义的结构特征**来绘制清晰的区域边界，是大多数地图的根本缺陷，并被沃格特学派发展到了荒谬的地步。



“举个例子，任何人都能看出布罗德曼17区和18区的区别。但他18区和19区的区别是微不足道的，很难辨认。”<br>在一张地图上给这三个区域画上三个不同的标记--如点、交叉线和虚线--完全是在制造一种误导的印象。<br>尽管这类图对皮质连接的描述很有用，但它们不能准确地翻译细胞构筑数据。



在现代神经科学文献中，人们对类似的分离与区域间的渐变问题再次产生了兴趣。事实上，布罗德曼本人断言，一些区域显示了过渡区(布罗德曼，1909)。<br>虽然感兴趣的特征已经从细胞结构转移到功能磁共振时间序列分析或扩散磁共振波束成像(更一般地在网络分析、连接和基于连接的分区的背景下)，但早期辩论的一些主题仍然存在。<br>例如：**在什么时候以及在多大程度上，将皮质聚集成不同的地块是合适的**？<br>而且，正如(Mesulam，2008,1998)所探讨的那样，大脑皮层区域之间的区域间关系是什么



2004年，一种基于谱图理论的新方法出现在文献中，用**扩散磁共振波束成像技术**研究大脑皮质连接模式的变化(Johansen-Berg等人，2004)。<br>类似的方法已经成为使用弥散和功能磁共振对大脑皮质进行分割的流行工具(Cloutmanet al.，2012；Craddock等人，2012；Devlin等人，2006；Eickhoff等人，2015；O‘Donnell等人，2013,2006)。<br>最近，类似的技术也被用来探索当一个人穿过大脑皮层时，区域间连接模式的变化(例如，通过脑束成像或功能连接的结构连接)；**所谓的特征相似梯度(**Bajada等人，2017；Cerliani等人，2012；Haak等人，2018；Jackson等人，2017；Marulies等人，2016)。<br>事实上，马古利斯等人。(2016)的研究表明，在可能取决于相似性矩阵构造的某些限制下，**主要的RS-fMRI特征梯度反映了Mesulam(2008)概述并由Buckner等人阐述的区域间关系**。其中该**梯度在两端具有通道选择性和通道一般皮质**。虽然这一概念可能不会被新手读者完全理解，但我们希望在本文结束时(特别是在阅读补充案文之后)对这样一种说法的解释将是显而易见的。

where this gradient has modality selective andmodality general cortices on either end





这些技术吸引了神经成像界，因为它们有可能为了解大脑中神经结构或功能的相似性提供灵活、统一的框架(参见Paquola等人，2020,2019年；Vazquez-Rodríguez等人，2019年，例如这些概念可以如何灵活地跨多个模块使用)。<br>在这篇文章中，我们通过引入一种方法来进一步扩展这个框架，以衡量每个领域的定义有多严格，展示了沃格特和贝利和冯·博宁的想法之间的各种可能性；沃格特-贝利指数。



我们使用历史背景来强调通过“特征梯度”--例如，功能磁共振成像、纤维束成像、细胞构造学等--摆脱对皮质组织的思考的重要性，这些特征梯度弥合了旧争论之间的鸿沟。<br>具体地说，我们将应用这里描述的工具来帮助解决20世纪中叶开始的一场讨论。<br>我们还提供了两个用MatLab和Python编写的工具来实现这项工作中概述的算法，从而使感兴趣的读者可以使用他们的行数据来计算VB指数(https://doi.org/10.5281/zenodo.3609459，https://github.com/VBIndex/)(Da Costa Campos和Bajada，2020年)。<br>也可以使用Python的de factopackage管理器pip安装推荐的软件生产版本，其中带有“pip install vb_TOOLBOX”。这样做之后，软件vb_TOOL就可以使用了。<br>有关用法的详细信息，请参阅该软件的GitHub RePosory的完整文档



我们注意到，各个团体已经发布了自己的“梯度分析”管道和工具箱，包括Marguies等人早期的“梯度管道”。<br>(2016)，连接话题图专注于连接变化的区域模式及其统计测试，Haak等人(2018)，Guell等人的LittleBrain Focus小脑梯度。<br>(2019)，以及沃斯·德·瓦莱特最近推出的通用渐变工具箱Brainspace。<br>(2019年)。<br>所有这些工作流和工具箱在下面描述的某些选择上都有细微的差异。<br>其中一些还包括对梯度图执行统计测试的能力。<br>本文中介绍的软件创建了与其他可用的软件包类似但不一定相同的“梯度图”，此外，它是迄今为止**唯一允许计算VB指数的软件包**(如所述的5.1)。



在本文的其余部分，我们将描述和探索**从数据中提取特征相似性梯度和VB索引**所需步骤的细节。<br>我们讨论了**测量大脑区域之间相似性的方法**，**为什么将这些得到的相似性度量看作一个数学图是有用的，以及如何进一步处理该图以获得所需的梯度图。<br>在本文中，我们将讨论主要基于拉普拉斯特征映射的技术，一般而言，寻找此类数据的有意义的结构和几何描述的问题通常被描述为某种类型的非线性降维**。虽然几种形式的降维用于构建皮质梯度(或皮质下、小脑等)。已经在文献中使用(Coifman和Lafon，2006；Haak等人，2018；Johansen-Berg等人，2004；Margulieset al.，2016)，它们在精神上类似于这里审查的拉普拉斯特征映射。



### 什么是图？

大多数**特征梯度分析算法都是从谱图理论的数学原理中产生的**。
这是一种通过**计算总结图的矩阵的特征值和特征向量来研究图的性质的方法**。
虽然在本文中详细解释特征值和特征向量会很长，但我们希望在后面的章节中，它们在所描述的上下文中的用法将变得更加清楚。

图是一种数学结构，它定义了各种对象之间的关系。
例如，图1中的结构。
1是定义四个对象之间关系的图形。
每个物体都被称为一个节点

这些**节点可以被认为是大脑皮层中的体素(或表面顶点)或感兴趣的皮质区域。连接这些节点的线条称为边**。<br>在神经成像中，边几乎总是无方向的，这意味着如果节点a连接到节点b，则相反的情况也是正确的。

要继续下去，需要一些基本概念。<br>邻接矩阵是正方形矩阵(即，相同数量的行和列)，其中每行和每列表示单个节点，并且矩阵中的元素表示行节点和列节点之间的关系

**度矩阵是对角线矩阵，沿对角线的条目表示每个节点的度，即与该节点相连(相邻)的节点数。**

例如，节点的阶数为3，因为它与三个节点(b、andd)相邻。<br>**度矩阵D可以计算为邻接矩阵的行/列和**。<br>如图所示。<br>1，度矩阵为

![截屏2022-11-15 15.12.44](/Users/haozhipeng/Library/Application Support/typora-user-images/截屏2022-11-15 15.12.44.png)



有4个节点的图的表示法。<br>**每个节点都可以被认为是体素或感兴趣区域。节点之间的边表示它们之间的关系；这些边可以是结构连接，也可以是节点之间的相似性(亲和力)的度量**



**拉普拉斯矩阵定义为度矩阵d减去邻接矩阵**![截屏2022-11-15 15.28.56](/Users/haozhipeng/Library/Application Support/typora-user-images/截屏2022-11-15 15.28.56.png)

虽然拉普拉斯的确切含义可能很难让任何读者直观，但我们希望在第4节中使用它能给读者一些直觉。<br>在这一点上，值得注意的是，在许多应用中，包括在神经成像中，人们可以定义一个加权图，其中连接节点的每个连接都带有不同的权重。<br>例如，**高权重可能意味着两个节点强连接，而低权重则表示节点连接不是那么强**。<br>现在可以定义邻接矩阵的加权形式，它可以用来描述加权图。

在一般情况下，加权邻接矩阵可以定义为![截屏2022-11-15 15.38.51](/Users/haozhipeng/Library/Application Support/typora-user-images/截屏2022-11-15 15.38.51.png)

稍后我们将看到，该矩阵可以与相似性或亲和力矩阵的概念相关联。<br>在上面的例子中，加权邻接矩阵可以写成用相应的权重替换邻接矩阵中的1。<br>**度矩阵和拉普拉斯矩阵的加权形式可以用与前面相同的方式来定义**。



此后，除非另有说明，否则我们将拉普拉斯矩阵、度矩阵和邻接矩阵称为它们的广义加权形式



### 2.1. 神经成像中的图形

出于神经成像的目的，图形可以是两种截然不同的类型之一。从概念上来说，**创建大脑图形的最简单的方法是考虑其结构联系**。<br>例如，图中的图中的节点。<br>1可以代表大脑区域(例如小脑、脑干等)。<br>边缘可以代表连接这些脑区的区域。<br>换句话说，**这些图可以通过轨迹图得到，假设每个体素(或感兴趣区域)是一个节点，每个轨迹是连接两个节点的边**。<br>我们称这些图为有向图，因为边是每个节点之间的直接连接。<br>人们可以将这些视为友谊网络，其中两个人之间的优势取决于他们是否是朋友





**构造图的另一种方法是计算一个区域的感兴趣特征与另一个区域的相同特征之间的相似性度量**。<br>**1.对于结构数据**，**轨迹图算法(单个体素的轨迹图)的整个输出可以被认为是体素的特征，并且被成对比较以获得体素之间的相似性矩阵**(Bajada等人，2017；Cerliani等人，2012；Devlin等人，2006；Johansen-Berg等人，2004)。

【dti =》相似性矩阵】

**2.对于功能数据，可以使用fMRI时间序列。在这种情况下，节点仍然是体素，但边是一个体素特征与另一个体素特征相似程度的权重。如果我们认为两个人是网络中的节点，他们的边权重将由两个人的相似程度决定，基于个人特征(如着装感觉、工作等)。**<br>我们称这为特征相似图。<br>为简单起见，这是我们将在本文的其余部分讨论的图形类型。<br>值得注意的是，fMRI文献中的许多工作**不是在特征本身(例如时间序列)上进行相似性计算，而是在“功能连通性”矩阵上进行相似性计算**(c.f.Marulies等人，2016)。<br>**对于上面提出的“人际网络”，如果我们假设“功能连通性”提供了关于两个人之间的“友谊程度”的信息**，那么最后一种方法的**相似度矩阵表明了每个人的友谊网络之间的相似性。**

【fmri时间序列 =》 功能联通矩阵 =〉相似性矩阵】

### 3.相似度、亲和度或邻接矩阵

节点是否已连接。<br>通过使用加权邻接矩阵提供了更详细的描述。<br>然后问题是如何定义权重，而权重又取决于我们想要描述的是哪种图形

**在神经成像中，权重可以根据描述一个体素或顶点（例如fMRI时间序列或一组流线）的特征在多大程度上与感兴趣区域中的每个其他体素相似的相似性度量来定义这是在所有体素(或顶点)上完成的**。我们将这样的加权邻接矩阵称为**相似或亲和矩阵**



**选择相似性度量非常重要，因为它会影响可能对数据进行的任何聚类。**
到目前为止，**两个体素之间最流行的相似性度量是皮尔逊相关系数，它可以被解释为集中和归一化的点积**(Cerliani等人，2012；Craddock等人，2012；Devlin等人，2006；Johansen-Berg等人，2004；Klein等人，2007；Zhang等人，2014)；见下一节，讨论点积和其他相似度量。
为了理解**相关性作为相似性度量的效用**，下面对其前身进行了简短的描述(CFO‘Connor，2012是一个直观的回顾)。
然后，我们将在相邻代码中引入一项轻微的修改

用于这些分析的算法的一个警告是邻接矩阵必须是非负的。<br>对于大多数相似性度量，包括4.1节中介绍的那些，这并不是自动成立的。因此，**必须使用某种技术来确保对应的相似性矩阵只包含非负权重**

例如，Johan-sen-Berg等人。
(2004)**建议在相似矩阵中增加一个标量常量，以确保所有值都为正，而其他只将正值保持在某个阈值上**





一旦创建了相似性矩阵，就可以用它来表示在其上执行所有计算的图。<br>关于相似性矩阵的最后一个考虑是，**是否应该使用全套相似性，或者是否应该以某种方式对相似性矩阵进行阈值**(Von Luxburg，2007)。<br>例如，所有低于某个任意值ε的权重都可以设置为零；其余的权重可以保留或二进制(这将与使用简单的邻接矩阵相同)。**限制邻域的另一种方法是将权重限制到k个最近的邻域**。<br>这两种数据简化方法的优点都是它们**去除了噪声权重，并使矩阵稀疏，从而导致计算更快、更便宜**。<br>例如，在fMR中，Ivoxels可能具有非常低的相关性(权重)，这不是因为任何内在的功能连接，而是因为噪声



### 相似度量



衡量两个数据集(被认为是向量)相似性的最基本方法是**两个向量的点积**(考虑**fMRI时间序列**或**被展平成一个长向量的区域密度图(或轨迹图)的三维图像**)。

从几何上讲，两个向量的点积是一个向量到另一个向量的投影。

在这种形式中，**点积有两个分量：两个数据集(被视为向量)之间的角度的余弦和它们的大小。这意味着大小和角度相似性(用角度的切线来衡量)是混淆的**。<br>为了解决这个问题，可以通过**除以每个数据集的大小来归一化点积，这就给我们留下了余弦函数**。

余弦相似性的一个问题是，它对**样本之间数据的相对移位很敏感(**例如，由于不感兴趣的绝对信号差异，可能会在fMRI时间序列中发生)。<br>最常见的建立平移不变相似度的方法是对**数据中心取平均值，然后计算余弦相似度，即样本Pear-son的相关系数![截屏2022-11-15 19.00.14](/Users/haozhipeng/Library/Application Support/typora-user-images/截屏2022-11-15 19.00.14.png)**

其中x和y是大小为x和y的常量向量，其中每个元素分别为x和y的平均值。<br>平移不变是相关系数的一个吸引人的性质，对于比较均值不同的变量特别有用。<br>文献中使用余弦相似性的作品的例子可以在下面的文章中找到



人们应该记住，余弦是一个正弦函数。<br>因此，**余弦相似度或相关性的值为0.5并不意味着两个数据集之间的角度为45。解决此问题的简单方法是使用反余弦函数(反余弦)计算两个数据集之间的角度**，并按90(或π/2)进行归一化：

![截屏2022-11-15 19.03.43](/Users/haozhipeng/Library/Application Support/typora-user-images/截屏2022-11-15 19.03.43.png)

上面的公式将测量介于0和2之间的两个数据集之间的归一化“角距离”。

我们可以这样定义**数量**，如下所示![截屏2022-11-15 19.05.02](/Users/haozhipeng/Library/Application Support/typora-user-images/截屏2022-11-15 19.05.02.png)

该度量返回的值具有对相关系数(或余弦相似性)的几乎相同的解释，但是具有这样的良好属性，即，**值0.5意味着两个数据集介于正交线和共线正中间，而值-0.5意味着这两个数据集介于正交线和反共线正中间**。<br>使用归一化角度的的例子包括



### 4.谱变换与图的拉普拉斯

一旦计算出相似度(也称为亲和度或邻接度)矩阵，我们就拥有了**描述个体节点之间关系的所有信息**。<br>我们的下一步是将我们的**数据嵌入到一个低维空间(目前是一维线)，其中节点彼此之间和空间的中心的距离反映了节点间的亲和力**。![截屏2022-11-15 19.52.34](/Users/haozhipeng/Library/Application Support/typora-user-images/截屏2022-11-15 19.52.34.png)

虽然我们请读者参考补充材料(附录C)对问题进行非正式讨论，但该过程可以被表示为优化问题的解，其中适当的成本函数U（x）被最小化

![截屏2022-11-15 19.12.05](/Users/haozhipeng/Library/Application Support/typora-user-images/截屏2022-11-15 19.12.05.png)

简而言之，**x是最小化成本函数的向量**。<br>这样的代价函数可以写成所有连接节点上的节点间距离平方(欧几里得)的加权和![截屏2022-11-15 19.14.01](/Users/haozhipeng/Library/Application Support/typora-user-images/截屏2022-11-15 19.14.01.png)

人们可以认为权重Wij是两个节点之间关系的度量，例如，大脑皮层顶点。<br>利用图论语言，可以将上述情况视为定义一个加权图，其中**每个结点的值表示每个个体的位置，而连接两个结点的边的权重表示它们之间的关系**

上述代价函数的最小化意味着**具有高关联值(即，高权重)的顶点对之间的长距离是不利的。**结果是，一对权重较高的顶点将被放置在彼此靠近的位置，

目标是**找到一个与所有顶点对相关的代价总和最小的位置**



然而，上述问题并不是很合适。<br>首先，它有一个平凡的解决方案，**即将所有顶点放置在同一位置(X是一个常量向量)，从而产生零成本**。<br>虽然这满足我们的成本函数的最小化，但它没有用，因为它没有告诉我们顶点之间的关系。



其次，如果bx是一种解决方案，那么bx通过一个恒定值(即进行的任何移位或重新缩放也将是一种解决方案，因为所产生的成本函数与移位或重新缩放是不变的。<br>因此，为了绕过平凡解和非唯一解，需要一些约束。<br**>最简单的约束是成本函数必须在(s.t.)约束下最小化。<br>位置向量x的大小等于1**。数学上写为![截屏2022-11-15 19.22.58](/Users/haozhipeng/Library/Application Support/typora-user-images/截屏2022-11-15 19.22.58.png)

请注意，这个约束并不能完全解决不变解的问题，因为一个不变的向量，仍然可以产生零余量也满足该约束。
我们稍后会看到，由于这个解决方案是事先知道的，所以在优化后很容易解释它。
一般而言，**约束极小化问题可以用拉格朗日乘子法**(cfHagen and Kahng，1992)来解决。
虽然拉格朗日乘子的详细解释超出了本文的范围，但修改使计算更容易求解，同时保持其准确性。
这种方法的思想很简单：我们将**约束增加到成本函数本身中**。因此，我们将问题重写为

![截屏2022-11-15 19.24.52](/Users/haozhipeng/Library/Application Support/typora-user-images/截屏2022-11-15 19.24.52.png)

现在，任何不符合约束的假定解决方案都将受到惩罚。
这一惩罚由权重乘数决定，通常称为拉格朗日乘数(λ)。
我们从以下几个方面着手解决这个问题。
首先，将优化问题重写如下(详见附录A)：![截屏2022-11-15 19.25.33](/Users/haozhipeng/Library/Application Support/typora-user-images/截屏2022-11-15 19.25.33.png)

最小化现在可以通过取修改的成本函数的一阶导数~U，并等于零(极值条件)来以通常的方式进行。![截屏2022-11-15 19.26.08](/Users/haozhipeng/Library/Application Support/typora-user-images/截屏2022-11-15 19.26.08.png)

![截屏2022-11-15 19.26.41](/Users/haozhipeng/Library/Application Support/typora-user-images/截屏2022-11-15 19.26.41.png)

```
最后一个表达式定义了拉普拉斯函数的标准本征值问题，可以使用标准数值库(例如，MatLab函数eig)来求解。<br>这对叫本征对，叫λ；bx，λ叫本征值，bx叫本征向量。<br>特征值和特征向量在广泛的应用中是有用的，对它们的解释取决于它们使用的上下文
```

![截屏2022-11-15 19.29.09](/Users/haozhipeng/Library/Application Support/typora-user-images/截屏2022-11-15 19.29.09.png)

在本文中，我们将重点讨论**拉普拉斯算子的特征向量，因为它们包含了我们将用来创建梯度的信息**。然而，这些特征值也编码了重要的信息。<br>假定拉普拉斯矩阵是半正定的，其最小特征值为零，且与之相关的特征向量为常数，因此，我们将重点讨论**次小特征值，称为图的代数连通性**



Fiedler(1973)指出，**代数连通度的大小反映了整个图的连通性有多好**，即代数连通度越大，就越难将图分割成独立的分支。<br>如果代数连通性为零，则表示该图不是连通的；即至少有两个图划分。<br>换句话说，如果一个图至少有两个硬簇(即它是两个完全不连通的子图)，那么它的代数连通度将为零。<br>图的连通度越高，其代数连通性就越高。<br>这一直觉将在部分中重新讨论。

**第一个特征值为零的事实直接表明其关联的特征向量不携带关于节点的相对位置的任何有用信息**。<br>因此，**最优解被编码到与次小特征值相关联的特征向量中**。<br>这是以最先在图划分的背景下描述这一解的数学家(Fiedler，1973)的名字命名的。在这个阶段，值得注意的是，所描述的问题的解是有偏差的，因为高次的节点将主导最小化，因为拉氏矩阵的对应行(或列)是主导的。<br>这意味着**具有大量邻居(即，高程度)的节点将倾向于被分组在一起，而与它们的相似性无关**。<br>这种偏差可以通过使用修改后的约束xTDx1来补偿，这样我们的优化问题就可以转化为

![截屏2022-11-15 19.32.25](/Users/haozhipeng/Library/Application Support/typora-user-images/截屏2022-11-15 19.32.25.png)

新的限制意味着节点根据其程度被惩罚(即，它们被分配更高的成本)(Johansen-Berg等人，2004年)。<br>通过遵循相同的数学推导，如上所述，相关的特征值问题

![截屏2022-11-15 19.33.08](/Users/haozhipeng/Library/Application Support/typora-user-images/截屏2022-11-15 19.33.08.png)

这就是**矩阵LandD的广义特征值问题，它也可以用标准工具箱来数值求解。通常，能够解决标准特征值问题的工具箱也可以用来求解广义问题**。<br>例如，这就是MatLab和Scipy的seig函数的情况。

通常，拉普拉斯矩阵以规格化形式使用(即，相对于节点度而言不失真)，因此其对角线元素全部为一。<br>然而，可以证明，**归一化拉普拉斯在某种程度上等价于改变最小化问题的约束，因此必须清楚给定的归一化如何影响解**。<br>文献中已经使用了几个版本的归一化拉普拉斯。<br>在附录B中，我们描述了对称归一化拉普拉斯算子和随机游动归一化拉普拉斯算子



### 5.重排序、特征映射和Vogt-Bailey指数

如果我们认为脑体素或皮质表面顶点是具有相关特征的节点(如fMRI时间序列或轨迹图等)，而这些特征之间的关系是图上的边，我们先前描述的**第二小特征向量描述了每个节点在一维中的位置(坐标)，这是一条线，由每个节点相互之间的关系(亲和力)决定**。<br>**使用位置作为热图的值成为一种将大脑上的这些关系可视化的方法(所谓的大尺度梯度)**。<br>此外，**特征向量的分量表示节点在包含与特征向量一样多的维度的空间中的坐标(它不限于单一维度)**。<br>因此，**具有第二个最小特征值的特征向量将给出直线上节点的坐标，第二个和第三个特征向量将给出平面上的坐标，以此类推**。<br>为此，需要更复杂的可视化。<br>也可以独立地表示高维梯度，但必须始终记住，**第二个梯度受第一个梯度的影响，第三个受前两个梯度的影响，依此类推。**

 

此外，代数连通性表示感兴趣区域中最佳分裂(或簇)的锐度。<br>如果**对当地社区进行探照灯VB指数分析(见第5.3节)，我们可以研究中观梯度(或区域边界之间的过渡)。**



### 5.1.谱重排序

**将嵌入位置映射到大脑的最简单方法是为每个体素或顶点指定一个热图值，该值对应于它们在嵌入中的排名顺序**。
这种方法**允许研究整个大脑的特征变化的一般模式，但由于被排序，不提供关于顶点之间的实际特征距离的任何细节**(例如，C.f.Bajada等人，2017；C.f.Johansen-Berg等人，2004年，用于分割的文献中的原始光谱重新排序论文)。



### 5.2. Eigenmaps

拉普拉斯特征映射(Belkin and Niyogi，2003,2002)与谱重排序密切相关。
特征映射的使用已被引入神经科学文献(Cerliani等人，2012年；Haak等人，2018年)。
在一维中，该方法使用**拉普拉斯主特征向量给出的坐标点作为感兴趣体素的强度**。由于可以在多个维度上探索体素之间的关系，该方法具有特别的优势。
实际上，**可以将相似性或特征空间的坐标映射到调色板中，并且可以通过将该值分配给相应的体素来将所得到的颜色映射值映射到脑空间上**(参见Bajadaet al.，2019)。
这意味着人们只能映射与调色板的维度一样多的维度(在我们的例子中是3维RGB调色板)。**重新排序和特征映射为我们提供了在低维空间中最佳嵌入体素的映射。**
**实际上，具有相似值的体素(或ROI)彼此之间具有更大的亲和力。**
这建立了大脑皮层的大范围组织梯度。
它还提供了一些迹象，**表明是否存在跨越该梯度的急剧不连续，但仅关注特征向量不能量化皮质区域内关系的不连续程度**。
**本征值提供了一种解决方案**。



### 5.3.代数连通性与Vogt-Bailey指数

图的代数连通性是该图“良好连接”程度的指示器。它是拉普拉斯矩阵的第二个最小的特征值(见第4节)。**一旦归一化到0和1之间(通过除以除第一个特征值之外的所有特征值的平均值，这是一个具有亲和力矩阵的图的最大值)**，代数连通性可以用作一个指示器，表明特定的神经区域至少有一个清晰的描绘或只包括分级的差异。这允许**量化关于皮质中存在的区域间转换**的程度的历史问题。
虽然沃格特人主要主张明确划分大脑区域，但布罗德曼在他1909年的专著中明确指出，**一些区域的细胞结构边界是分级的。**
在极端情况下，Bailey和von Bonin(1951)主张有效地分级皮质(除了一些小的例外)。
因此，我们提出了“Vogt-Bailey指数”这一术语来描述拉普拉斯图的归一化代数连通性，该图用于描述神经科学背景下的特征相似程度



这种方法可以在整个大脑皮层上进行，**以在预定义的簇(如休眠状态网络)上为整个大脑皮层的“等级”给出单一值，或者给出每个感兴趣区域的值，该值量化该区域中特征的相似程度**。然而，我们注意到，这个值本身并不能告诉我们什么，因为这个值会受到平滑(存在于MRI信号中)的影响。<br>然而，它可以被用来作为一种相对测量，人们可以在其中比较同一大脑或不同受试者之间的区域(见第5.3节)。<br>有关统计分析的备注)。



最后，可以使用顶点探照灯来计算整个大脑皮层的Vogt-Bailey(VB)指数。<br>使用这种方法，**计算了相邻皮质体素或顶点的邻域(如相邻代码中所假定的)，并计算了其亲和图的(归一化)代数连通性**。<br>**计算出的VB指数给出了探照灯中心的特征(功能磁共振成像、跟踪成像或其他)与其最近邻居的相似程度的值**。<br>最终的结果是一个**有效的皮质边缘检测算**法(参见图)。<br>2和3为直观的示例)，其中应出现地块之间的边界图。<br>

当然，它们的相对敏锐性应该是显而易见的。<br>当然，平滑效果和体素/顶点大小会限制预期的分辨率。<br>事实上，在核磁共振分析中，这样的概念并不新鲜。<br>区域同质性(ReHo)的概念自fMRI早期就存在(酱和Zuo，2016；Zang等人，2004)。<br>此外，该方法与微观结构分割的观察者无关方法有相似之处(Schleicher等人，1999年)。<br>我们的方法简单地将这些关于区域均质性和边界的想法融入灵活和更一般的框架中，该框架既不限制所使用的相似性度量方法(例如微结构分离方法)，也不限制感兴趣的特征(例如在REHO和微结构分离的观测独立方法中)。



![截屏2022-11-15 20.14.35](/Users/haozhipeng/Library/Application Support/typora-user-images/截屏2022-11-15 20.14.35.png)

**图2.VB索引应用于一张照片(左上角)，使用所有三个拉普拉斯矩阵的归一化。<br>颜色范围从黑色(0)到白色(1)，其中在图像中有均匀的结构。**



![截屏2022-11-15 20.18.47](/Users/haozhipeng/Library/Application Support/typora-user-images/截屏2022-11-15 20.18.47.png)



图3.a)合成数据上的梯度图，显示了预期的模式，其中地块内的值非常相似，但地块之间的值不同。<br>B)皮质表面上突出显示任意地块的VBIndex。**所有结果都显示了缺省的广义特征值问题解。**



总之，VB指数是用来描述神经科学背景下特征相似程度的拉普拉斯图的归一化代数连通性的建议术语。<br>该软件可以产生三种“类型”的VB指数：1)全脑分析，它还计算整个大脑的单个VB指数；

2)聚类分析，它计算每个感兴趣区域的梯度和VB指数；以及

3)探照灯VB指数，它根据直接相邻顶点的邻域数据计算每个顶点的VB指数。<br>簇的大小(从最接近的5或6个邻居到整个大脑)与VB指数的解释有关。<br>正如菲尔德(1973)在最初的论文中指出的那样，代数连通度的值提供了分割图的难度的度量(值越高，表示越“连通性”，也就是越难分割)。<br>如果为零，则表示图中至少有一个完全分裂。<br>因此，**随着集群变得更大，图表更容易一分为二的可能性更大，这就是VB指数所衡量的**。<br>**在探照灯的情况下，因为我们只观察5到6个相连的邻居，所以解释更直接：在那个顶点附近有边吗？**





### 6.关于统计分析的说明

这篇文章着重于建立对大尺度梯度的概念性理解和使用磁共振数据量化边界边缘。关于大尺度特征梯度的统计处理，正在出现一种文献，讨论在梯度图上使用的各种统计方法。
鼓励读者探索本节中有关梯度统计的当前方法的文章

关于VB索引图的统计分析，还需要进一步的工作来区分MR噪声和固有光滑度对特征相似度的影响。
**噪声去除的一种研究途径包括生成具有与基础MRI数据相似的噪声和基线平滑的零模型**



VB工具箱是一个基于GPL许可的免费可用、开放源码的项目，我们希望随着人们对梯度分析领域兴趣的增长，该工具箱将会增长到包含用于对梯度图和VB指数进行推断的各种统计方法



### 实验

### 7.1.。摄影示例：Searchlight VB索引

在将VB索引应用于相当抽象的函数MRI概念之前，我们已经在相应版本的工具箱中提供了在彩色照片(https://github.com/VBIndex/matlab_vb_toolbox/tree/master/vb_index_intuitive_example).上实现VB索引的MatLab脚本。<br>2D照片中的每个像素都可以被认为是大脑表面的平均点。<br>函数数据由像素的色调、饱和度及其亮度值表示。<br>对照片执行VBIndex探照灯操作，如第5.3节所述。<br>结果对图像的边界进行了量化(见图2)。<br>2).邀请读者通过免费提供的其他图片探索此脚本，或使用他们自己的照片进行尝试



### 7.2.。神经成像示例：模拟MRI数据示例

在彩色照片上验证该技术之后，在已知基本事实的合成MRI数据上对该技术的性能进行了评估。
为此，来自HCP数据集的皮质表面被任意分割成6个连续的地块。
同一地块中的顶点被分配了相同的时间序列，这在不同的地块中是不同的。
使用版本1.1.0的pythonvb_TOOL.FIG进行分析。
3给出了将所提出的方法应用于模拟数据的结果。
**正如预期的那样，整个大脑梯度显示出一种分段恒定的模式，反映了上文描述的(未知)地块之间的相似结构(图3A)。**
**与此结果一致，顶点方向的VB指数显示出一种模式，其中地块之间的边被突出显示(图3B)**



### 7.3.。神经成像示例：人类连接组项目数据示例

相邻的工具箱在来自人类连接组项目数据库的24(24)个个体(12个)上运行。
计算是在两个不同的rs-fmri测试中进行的，每个参与者在两个大脑半球上都进行了测试。
数据集由HCP使用最小二进制处理流水线进行预处理(Glasser等人，2013年)。
数据收集得到了华盛顿大学机构审查委员会(IRB)的批准，数据的处理得到了马耳他大学研究伦理委员会的进一步批准。数据根据上述文本中概述的程序使用1.1.0版的pythonvb_Tool进行处理；所有计算都使用了广义特征值问题进行计算。



![截屏2022-11-15 20.34.15](/Users/haozhipeng/Library/Application Support/typora-user-images/截屏2022-11-15 20.34.15.png)

**图4.以rs-fmri为特征的整个大脑皮层的主要相似性梯度样本(左)。**
**在预聚类皮质上计算的主梯度的样本(使用HCP多模式分割，右)**



![截屏2022-11-15 20.35.30](/Users/haozhipeng/Library/Application Support/typora-user-images/截屏2022-11-15 20.35.30.png)

**一次运行24个个体的基本相似性梯度。**
**在补充材料中可以找到相同参与者在第二次fMRI测试中的图像。**



**并计算了其拉普拉斯算子的特征分解。这导致了图。4(左)，显示单个受试者的两个半球的整个皮质的初级大范围区域间(特征)梯度的样本。**
5显示所有24名受试者在左侧大脑半球外侧表面进行单次RS-fMRI扫描。



我们注意到，原则梯度与先前发表的工作略有不同(c.f.Marulies等人，2016年)。
这可能是由于参数选择的多重差异(并讨论了简要昆虫2.1)。
简而言之，主梯度高度依赖于亲和力矩阵的性质；我们的亲和力矩阵与Marguies等人的亲和力矩阵之间最相关的区别。
(2016)是**后者只保留了前10%的函数连接和随后的余弦相似性计算**，而我们的方法(参见Jacksonet al.，2020,2017，稍作修改)**接受所有正相关关系，然后将其转换为归一化的角度距离。**
**阈值在解释结果中起着重要的作用。****较高的阈值(例如只保留前10%的连接)将只考虑“连接良好”的垂直的相似性，而不会考虑中等连接和连接较差的垂直。**
**我们方法只消除负权重，将这些连接考虑在内，但也会对“虚假”连接更敏感。**



其次，使用工具箱计算使用多模式HCP分割的数据的主要梯度及其相关的VB指数(Glasser等人，2016)。<br>这些结果的样本可以在图中找到。<br>3(右)，其中**主坡度是在每个地块中计算的**。<br>**与这些地块相关联的是每个地块的VB指数**(参见图7正确和下面的进一步讨论)。

![截屏2022-11-15 20.49.01](/Users/haozhipeng/Library/Application Support/typora-user-images/截屏2022-11-15 20.49.01.png)

**图6.VB指数在一次运行中计算了24个人。<br>在辅助材料中可以找到相同参与者在第二次fMRI检查中的图像**

![截屏2022-11-15 20.50.03](/Users/haozhipeng/Library/Application Support/typora-user-images/截屏2022-11-15 20.50.03.png)

**平均(单次运行)24个人的探照灯、局部邻居、全脑VB指数，识别大脑皮质上相对清晰的边界区域。**



最后，计算所有参与者的顶点探照灯VB指数。这种方法以**数据驱动的方式突出了皮质上的特征边缘和边界**。
图6显示了所有24名参与者的探照灯VB指数。7(左)显示的是顶点方向的平均VB指数。
我们还可以在按顶点计算的VB指数组(图4左)和基于簇计算的VB指数组之间看到类似的模式

## 结论

神经功能分级的概念至少在二十世纪初就已经存在，并在整个二十一世纪初在神经成像界获得了吸引力。<br>本文概述了谱变换背后的一般概念和数学直觉，并介绍了**谱重排序、拉普拉斯特征映射和聚类等相关技术**。<br>作为本文的辅助工具，可使用执行第4节中讨论的不同谱变换的MATLAB和Python工具。<br>根据数据的大小，该技术可能会占用相当多的RAM和计算时间，然而，在标准网格采样时，我们附加的代码可以在具有32 GB RAM的标准台式机或笔记本上运行完整的大脑梯度分析(使用HCP 32K表面)。虽然所描述的框架可以用于推理神经特征之间的关系，但仍有许多未回答的问题。<br>第一个重要问题涉及到相似度量的选择。<br>尽管上面讨论的所有指标都在一定程度上得到了使用，但仍需要进行系统比较，并指导在不同情况下使用哪种指标。

综上所述，希望本文和附带的工具将被用作有兴趣利用图中的神经特征及其区域间关系进行解剖研究的研究人员的指南。<br>6.VB指数一次计算了24个人。<br>在辅助材料中可以找到相同参与者在第二次功能磁共振成像中的图像。<br>7.平均(单次运行)24个人的探照灯、局部邻居、全脑VB-指数识别大脑皮质上相对清晰的边界区域。C.J.巴贾达等人.神经图像221(2020年)1171409。<br>
<br>大脑